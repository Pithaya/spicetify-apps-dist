!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var N,e,I,o,L,A,$,M,t,r,s,z,U,H,J,W,G,Q,K,V,Y,X,Z,h,a,ee,n,i,te,c,re,u,se,ne,ae,l,ie,d,p,f,oe,ce,ue,g,le,he,y,de,pe,fe,ge,ye,me,be,m,b,ve,we,xe,Se,ke,Be,Re,v,Pe,qe,Ee,Ce,_e,Fe,Te,De,je,Oe,Ne,Ie,Le,Ae,$e,Me,ze,Ue,He,Je,We,Ge,Qe,Ke,Ve,Ye,Xe,Ze,et,tt,rt,w,x,st,nt,S,at,it,ot;I=Object.create,o=Object.defineProperty,L=Object.getOwnPropertyDescriptor,A=Object.getOwnPropertyNames,$=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,t=(e,t,r)=>{r=null!=e?I($(e)):{};var s=!t&&e&&e.__esModule?r:o(r,"default",{value:e,enumerable:!0}),n=e,a=void 0,i=void 0;if(n&&"object"==typeof n||"function"==typeof n)for(let e of A(n))M.call(s,e)||e===a||o(s,e,{get:()=>n[e],enumerable:!(i=L(n,e))||i.enumerable});return s},r=(e,t,r)=>{var s;return s=r,(t="symbol"!=typeof t?t+"":t)in(e=e)?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,r},N={"external-global-plugin:react"(e,t){t.exports=Spicetify.React}},s=function(){return e||(0,N[A(N)[0]])((e={exports:{}}).exports,e),e.exports},z=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,U=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");var t=e.match(z);if(t)return t.shift(),t;throw new Error(`Invalid argument not valid semver ('${e}' received)`)},H=e=>"*"===e||"x"===e||"X"===e,J=e=>{var t=parseInt(e,10);return isNaN(t)?e:t},W=(e,t)=>{return H(e)||H(t)?0:([e,t]=(e=J(e),t=J(t),typeof e!=typeof t?[String(e),String(t)]:[e,t]),t<e?1:e<t?-1:0)},G=(t,r)=>{for(let e=0;e<Math.max(t.length,r.length);e++){var s=W(t[e]||"0",r[e]||"0");if(0!==s)return s}return 0},Q=(e,t,r)=>{var s=r;if("string"!=typeof s)throw new TypeError("Invalid operator type, expected string but got "+typeof s);if(-1===V.indexOf(s))throw new Error("Invalid operator, expected one of "+V.join("|"));s=t,t=U(t=e),s=U(s),e=t.pop(),n=s.pop();var n,s=0!==(t=G(t,s))?t:e&&n?G(e.split("."),n.split(".")):e||n?e?-1:1:0;return K[r].includes(s)},K={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},V=Object.keys(K),Y=class{analysis;constructor(e){e={bars:e.bars.map(e=>this.toRemixed(e)),beats:e.beats.map(e=>this.toRemixed(e)),sections:e.sections.map(e=>this.toRemixedSection(e)),segments:e.segments.map(e=>this.toRemixedSegment(e)),tatums:e.tatums.map(e=>this.toRemixed(e))};this.analysis=e}toRemixed(e){return{...e,firstOverlappingSegment:void 0,overlappingSegments:[],children:[],parent:void 0,indexInParent:0,prev:void 0,next:void 0,index:0}}toRemixedSection(e){return{...e,children:[],prev:void 0,next:void 0,index:0}}toRemixedSegment(e){return{...e,parent:void 0,indexInParent:0,prev:void 0,next:void 0,index:0}}remixTrack(){return this.preprocessTrack()}preprocessTrack(){for(const s of["sections","bars","beats","tatums","segments"]){var e,t,r=this.analysis[s];for([e,t]of r.entries())0<(t.index=e)?t.prev=r[e-1]:t.prev=null,e<r.length-1?t.next=r[e+1]:t.next=null}return this.connectQuanta(this.analysis.sections,this.analysis.bars),this.connectQuanta(this.analysis.bars,this.analysis.beats),this.connectQuanta(this.analysis.beats,this.analysis.tatums),this.connectQuanta(this.analysis.tatums,this.analysis.segments),this.connectFirstOverlappingSegment(this.analysis,this.analysis.bars),this.connectFirstOverlappingSegment(this.analysis,this.analysis.beats),this.connectFirstOverlappingSegment(this.analysis,this.analysis.tatums),this.connectAllOverlappingSegments(this.analysis,this.analysis.bars),this.connectAllOverlappingSegments(this.analysis,this.analysis.beats),this.connectAllOverlappingSegments(this.analysis,this.analysis.tatums),this.analysis}connectQuanta(e,t){let r=0;for(const n of e){n.children=[];for(let e=r;e<t.length;e++){var s=t[e];if(s.start>=n.start&&s.start<n.start+n.duration)s.parent=n,s.indexInParent=n.children.length,n.children.push(s),r=e;else if(s.start>n.start)break}}}connectFirstOverlappingSegment(e,t){let r=0;var s=e.segments;for(const a of t)for(let e=r;e<s.length;e++){var n=s[e];if(n.start>=a.start){a.firstOverlappingSegment=n,r=e;break}}}connectAllOverlappingSegments(e,t){let r=0;var s=e.segments;for(const a of t){a.overlappingSegments=[];for(let e=r;e<s.length;e++){var n=s[e];if(!(n.start+n.duration<a.start)){if(n.start>a.start+a.duration)break;r=e,a.overlappingSegments.push(n)}}}}},X=class{beatsPlayed=0;startTime=0;track;analysis;graph;currentRandomBranchChance=0;constructor(e,t,r){this.track=e,this.analysis=t,this.graph=r,this.currentRandomBranchChance=window.jukebox.settings.minRandomBranchChance,this.startTime=(new Date).getTime()}},Z=function(e,t){return(Z=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},h=mt(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}),C.prototype.unsubscribe=function(){var t,e,r;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var n=B(s),a=n.next();!a.done;a=n.next())a.value.remove(this)}catch(e){o={error:e}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}}else s.remove(this);var i=this.initialTeardown;if(E(i))try{i()}catch(e){r=e instanceof h?e.errors:[e]}var o=this._finalizers;if(o){this._finalizers=null;try{for(var c=B(o),u=c.next();!u.done;u=c.next()){var l=u.value;try{wt(l)}catch(e){r=null!=r?r:[],e instanceof h?r=P(P([],R(r)),R(e.errors)):r.push(e)}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}}if(r)throw new h(r)}},C.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)wt(e);else{if(e instanceof C){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(t=this._finalizers)?t:[]).push(e)}},C.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},C.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},C.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&bt(t,e)},C.prototype.remove=function(e){var t=this._finalizers;t&&bt(t,e),e instanceof C&&e._removeParent(this)},C.EMPTY=((v=new C).closed=!0,v),ee=(a=C).EMPTY,n={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},i={setTimeout:function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var n=i.delegate;return null!=n&&n.setTimeout?n.setTimeout.apply(n,P([e,t],R(r))):setTimeout.apply(void 0,P([e,t],R(r)))},clearTimeout:function(e){var t=i.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0},te=kt("C",void 0,void 0),c=null,k(_,re=a),_.create=function(e,t,r){return new l(e,t,r)},_.prototype.next=function(e){this.isStopped?Ct(kt("N",e,void 0),this):this._next(e)},_.prototype.error=function(e){this.isStopped?Ct(kt("E",void 0,e),this):(this.isStopped=!0,this._error(e))},_.prototype.complete=function(){this.isStopped?Ct(te,this):(this.isStopped=!0,this._complete())},_.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,re.prototype.unsubscribe.call(this),this.destination=null)},_.prototype._next=function(e){this.destination.next(e)},_.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},_.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},u=_,se=Function.prototype.bind,Pt.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Et(e)}},Pt.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Et(e)}else Et(e)},Pt.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Et(e)}},ne=Pt,k(qt,ae=u),l=qt,ie={closed:!0,next:St,error:function(e){throw e},complete:St},d="function"==typeof Symbol&&Symbol.observable||"@@observable",F.prototype.lift=function(e){var t=new F;return t.source=this,t.operator=e,t},F.prototype.subscribe=function(e,t,r){var s,n=this,a=(s=e)&&s instanceof u||function(e){return e&&E(e.next)&&E(e.error)&&E(e.complete)}(s)&&vt(s)?e:new l(e,t,r);return Bt(function(){var e=n.operator,t=n.source;a.add(e?e.call(a,t):t?n._subscribe(a):n._trySubscribe(a))}),a},F.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},F.prototype.forEach=function(s,e){var n=this;return new(e=Ft(e))(function(e,t){var r=new l({next:function(e){try{s(e)}catch(e){t(e),r.unsubscribe()}},error:t,complete:e});n.subscribe(r)})},F.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},F.prototype[d]=function(){return this},F.prototype.pipe=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(0===(t=e).length?_t:1===t.length?t[0]:function(e){return t.reduce(function(e,t){return t(e)},e)})(this)},F.prototype.toPromise=function(e){var s=this;return new(e=Ft(e))(function(e,t){var r;s.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})},F.create=function(e){return new F(e)},p=F,k(jt,f=u),jt.prototype.unsubscribe=function(){var e;this.shouldUnsubscribe&&!this.shouldUnsubscribe()||(e=this.closed,f.prototype.unsubscribe.call(this),e)||null==(e=this.onFinalize)||e.call(this)},oe=jt,ue=mt(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),k(T,ce=p),T.prototype.lift=function(e){var t=new he(this,this);return t.operator=e,t},T.prototype._throwIfClosed=function(){if(this.closed)throw new ue},T.prototype.next=function(n){var a=this;Bt(function(){var t,e;if(a._throwIfClosed(),!a.isStopped){a.currentObservers||(a.currentObservers=Array.from(a.observers));try{for(var r=B(a.currentObservers),s=r.next();!s.done;s=r.next())s.value.next(n)}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}})},T.prototype.error=function(t){var r=this;Bt(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var e=r.observers;e.length;)e.shift().error(t)}})},T.prototype.complete=function(){var t=this;Bt(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},T.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(T.prototype,"observed",{get:function(){var e;return 0<(null==(e=this.observers)?void 0:e.length)},enumerable:!1,configurable:!0}),T.prototype._trySubscribe=function(e){return this._throwIfClosed(),ce.prototype._trySubscribe.call(this,e)},T.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},T.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,s=this.isStopped,n=this.observers;return r||s?ee:(this.currentObservers=null,n.push(e),new a(function(){t.currentObservers=null,bt(n,e)}))},T.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,s=this.isStopped;t?e.error(r):s&&e.complete()},T.prototype.asObservable=function(){var e=new p;return e.source=this,e},T.create=function(e,t){return new he(e,t)},k(D,le=g=T),D.prototype.next=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.next)&&r.call(t,e)},D.prototype.error=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.error)&&r.call(t,e)},D.prototype.complete=function(){var e,t;null!=(t=null==(e=this.destination)?void 0:e.complete)&&t.call(e)},D.prototype._subscribe=function(e){var t;return null!=(t=null==(t=this.source)?void 0:t.subscribe(e))?t:ee},he=D,k(j,y=g),Object.defineProperty(j.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),j.prototype._subscribe=function(e){var t=y.prototype._subscribe.call(this,e);return t.closed||e.next(this._value),t},j.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},j.prototype.next=function(e){y.prototype.next.call(this,this._value=e)},de=j,pe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},fe="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",ge=Array.isArray,ye=["addListener","removeListener"],me=["addEventListener","removeEventListener"],be=["on","off"],r(b=m=class{maxBranchDistance=m.defaultBranchDistance;useDynamicBranchDistance=!1;minRandomBranchChance=m.defaultMinRandomBranchChance;maxRandomBranchChance=m.defaultMaxRandomBranchChance;randomBranchChanceDelta=m.defaultRandomBranchChanceDelta;maxJukeboxPlayTime=0;addLastEdge=!0;justBackwards=!1;justLongBranches=!1;removeSequentialBranches=!1;alwaysFollowLastBranch=!0;static fromPartial(e){var t=new m;return t.maxBranchDistance=e.maxBranchDistance,t.useDynamicBranchDistance=e.useDynamicBranchDistance,t.minRandomBranchChance=e.minRandomBranchChance,t.maxRandomBranchChance=e.maxRandomBranchChance,t.randomBranchChanceDelta=e.randomBranchChanceDelta,t.addLastEdge=e.addLastEdge,t.justBackwards=e.justBackwards,t.justLongBranches=e.justLongBranches,t.removeSequentialBranches=e.removeSequentialBranches,t.alwaysFollowLastBranch=e.alwaysFollowLastBranch,t.maxJukeboxPlayTime=e.maxJukeboxPlayTime,t}toPartial(){return{maxBranchDistance:this.maxBranchDistance,useDynamicBranchDistance:this.useDynamicBranchDistance,minRandomBranchChance:this.minRandomBranchChance,maxRandomBranchChance:this.maxRandomBranchChance,randomBranchChanceDelta:this.randomBranchChanceDelta,addLastEdge:this.addLastEdge,justBackwards:this.justBackwards,justLongBranches:this.justLongBranches,removeSequentialBranches:this.removeSequentialBranches,alwaysFollowLastBranch:this.alwaysFollowLastBranch,maxJukeboxPlayTime:this.maxJukeboxPlayTime}}},"minBeatsBeforeBranching",5),r(b,"rangeMinBranchDistance",2),r(b,"rangeMaxBranchDistance",80),r(b,"defaultBranchDistance",30),r(b,"defaultMinRandomBranchChance",.18),r(b,"defaultMaxRandomBranchChance",.5),r(b,"minRandomBranchChanceDelta",0),r(b,"maxRandomBranchChanceDelta",.2),r(b,"defaultRandomBranchChanceDelta",.018),ve=class{beats=[];lastBranchPoint=0;longestReach=0;constructor(e=[]){this.beats=e}},we=class{get id(){return this.source.index+"-"+this.destination.index}source;destination;distance;isPlaying;deleted;constructor(e,t,r){this.source=e,this.destination=t,this.distance=r,this.isPlaying=!1,this.deleted=!1}},xe=class{index;isPlaying=!1;next=null;previous=null;neighbours=[];start;duration;playCount=0;get end(){return this.start+this.duration}constructor(e,t,r){this.index=e,this.start=t,this.duration=r}toString(){return`[${this.index}]: ${this.start} - ${this.end} (${this.duration})`}isInBeat(e){return e>=this.start&&e<=this.end}},Se=class{constructor(e,t){this.settings=e,this.beats=t,this.graph=new ve,this.allNeighbours=t.map(()=>[]),this.minLongBranch=t.length/5}graph;allEdges=[];allNeighbours=[];minLongBranch=0;computedMaxBranchDistance=0;maxBranches=4;generateGraph(){var e,t,r=this.beats.map(e=>new xe(e.index,1e3*e.start,1e3*e.duration));for([e,t]of r.entries())e<r.length-1&&(t.next=r[e+1]),0<e&&(t.previous=r[e-1]);return this.graph=new ve(r),this.precalculateNearestNeighbors(),this.settings.useDynamicBranchDistance?this.dynamicCollectNearestNeighbors():(this.collectNearestNeighbors(this.settings.maxBranchDistance),this.computedMaxBranchDistance=this.settings.maxBranchDistance),this.postProcessNearestNeighbors(),this.graph}dynamicCollectNearestNeighbors(){var e=this.beats.length/6;let t;for(t=10;t<b.rangeMaxBranchDistance&&!(e<=this.collectNearestNeighbors(t));t+=5);this.computedMaxBranchDistance=t}precalculateNearestNeighbors(){if(0===this.allEdges.length)for(const e of this.beats)this.calculateNearestNeighborsForBeat(e)}calculateNearestNeighborsForBeat(r){var e,s,t=this.maxBranches,n=b.rangeMaxBranchDistance,a=[];for([e,s]of this.beats.entries())if(e!==r.index){let t=0;for(var[i,o]of r.overlappingSegments.entries()){let e=100;i<s.overlappingSegments.length&&(i=s.overlappingSegments[i],e=o.index===i.index?100:this.getSegmentsDistance(o,i)),t+=e}var c=r.indexInParent===s.indexInParent?0:100,c=t/r.overlappingSegments.length+c;c<n&&(c=new we(this.graph.beats[r.index],this.graph.beats[e],c),a.push(c))}a.sort((e,t)=>e.distance>t.distance?1:t.distance>e.distance?-1:0);for(let e=0;e<t&&e<a.length;e++){var u=a[e];this.allNeighbours[r.index].push(u),this.allEdges.push(u)}}getSegmentsDistance(e,t){return+this.getEuclideanDistance(e.timbre,t.timbre)+10*this.getEuclideanDistance(e.pitches,t.pitches)+ +Math.abs(e.loudness_start-t.loudness_start)+ +Math.abs(e.loudness_max-t.loudness_max)+100*Math.abs(e.duration-t.duration)+ +Math.abs(e.confidence-t.confidence)}getEuclideanDistance(t,r){let s=0;for(let e=0;e<t.length;e++){var n=r[e]-t[e];s+=n*n}return Math.sqrt(s)}collectNearestNeighbors(e){let t=0;for(var[r,s]of this.graph.beats.entries())s.neighbours=this.filterNearestNeighbors(r,e),0<s.neighbours.length&&(t+=1);return t}filterNearestNeighbors(t,r){return this.allNeighbours[t].filter(e=>!e.deleted&&!(this.settings.justBackwards&&e.destination.index>t||this.settings.justLongBranches&&Math.abs(e.destination.index-t)<this.minLongBranch)&&e.distance<=r)}postProcessNearestNeighbors(){this.settings.addLastEdge&&this.insertBestBackwardBranch(this.computedMaxBranchDistance,this.longestBackwardBranch()<50?65:55),this.graph.lastBranchPoint=this.findBestLastBeat(),this.filterOutBadBranches(),this.settings.removeSequentialBranches&&this.filterOutSequentialBranches()}longestBackwardBranch(){let e=0;for(const r of this.graph.beats)for(const s of r.neighbours){var t=r.index-s.destination.index;t>e&&(e=t)}return 100*e/this.beats.length}insertBestBackwardBranch(e,t){var r,s,n,a,i=[];for([r,s]of this.graph.beats.entries())for(const l of this.allNeighbours[r]){var o=l.destination.index,c=l.distance,u=r-o;0<u&&c<t&&(c=100*u/this.graph.beats.length,i.push({percentDistance:c,beatIndex:r,otherBeatIndex:o,currentBeat:s,edge:l}))}0!==i.length&&(i.sort((e,t)=>e.percentDistance-t.percentDistance),i.reverse(),a=(n=i[0]).currentBeat,e<(e=n.edge).distance)&&a.neighbours.push(e)}calculateReachability(){const r=this.graph.beats.map(e=>0);this.graph.beats.forEach((e,t)=>{r[t]=this.graph.beats.length-t});for(let e=0;e<1e3;e++){let t=0;for(var[s,n]of this.graph.beats.entries()){let e=!1;for(const i of n.neighbours){var a=r[i.destination.index];a>r[s]&&(r[s]=a,e=!0)}if(s<this.graph.beats.length-1&&(n=r[s+1])>r[s]&&(r[s]=n,e=!0),e){t++;for(let e=0;e<s;e++)r[e]<r[s]&&(r[e]=r[s])}}if(0===t)break}return r}findBestLastBeat(){var t=this.calculateReachability();let r=0,s=0;for(let e=this.graph.beats.length-1;0<=e;e--){var n=this.graph.beats[e],a=this.graph.beats.length-e,a=100*(t[e]-a)/this.beats.length;if(a>s&&0<n.neighbours.length&&(s=a,r=e,50<=a))break}return this.graph.longestReach=s,r}filterOutBadBranches(){const t=this.graph.lastBranchPoint;for(let e=0;e<t;e++){var r=this.graph.beats[e];r.neighbours=r.neighbours.filter(e=>e.destination.index<t)}}filterOutSequentialBranches(){for(let e=this.graph.beats.length-1;1<=e;e--){const t=this.graph.beats[e];t.neighbours=t.neighbours.filter(e=>!this.hasSequentialBranch(t,e))}}hasSequentialBranch(e,t){if(e.index!==this.graph.lastBranchPoint){var r=e.previous;if(null!==r){var s=e.index-t.destination.index;for(const n of r.neighbours)if(s==r.index-n.destination.index)return!0}}return!1}},ke=class{constructor(e,t){this.songState=e,this.settings=t}playerSubscription=new a;currentBeat=null;bouncing=!1;bounceSeed=null;bounceCount=0;lastBranch=null;isSeekingResolver=null;beatsSinceLastBranch=0;onProgressSubject=new g;onProgress$=this.onProgressSubject.asObservable();start(){this.logDebug("Driver started."),document.addEventListener("keydown",this.onBounceKeyDown),document.addEventListener("keyup",this.onBounceKeyUp);var e=$t(Spicetify.Player,"onprogress").pipe(It(e=>e.data),zt()).subscribe(e=>{this.process(e)});this.playerSubscription.add(e)}onBounceKeyDown=e=>{"Shift"===e.key&&(this.bouncing=!0)};onBounceKeyUp=e=>{"Shift"===e.key&&(this.bouncing=!1)};async process(e){if(null!==this.isSeekingResolver){if(this.logDebug(`Is seeking... ${e} -> `+this.currentBeat?.start),!this.isSeekingResolver(e))return;this.isSeekingResolver=null}if(this.logDebug(`Processing with current beat: ${this.currentBeat?.toString()}, player time: `+Spicetify.Player.getProgress()),null!==this.lastBranch&&this.setLastBranchPlaying(!1),null!==this.currentBeat){if(this.currentBeat.isInBeat(e))return;this.currentBeat.isPlaying=!1}this.beatsSinceLastBranch++;var t=this.currentBeat?.next?.end,r=this.currentBeat?.previous?.start,t=null!=t&&t<e||null!=r&&e<r,r=(t&&console.error(`Out of sync ! ${e} - `+this.currentBeat?.toString()),this.currentBeat);this.currentBeat=this.getNextBeat(e,t),null!==this.currentBeat&&(this.logDebug(`Got next beat: ${this.currentBeat?.index}, with time: ${this.currentBeat?.start} - ${this.currentBeat?.end}, player time: `+Spicetify.Player.getProgress()),await this.playBeat(r,this.currentBeat,e,t),this.currentBeat.playCount+=1,this.songState.beatsPlayed+=1,null!==r&&(r.isPlaying=!1),this.currentBeat.isPlaying=!0,this.onProgressSubject.next())}async playBeat(e,t,r,s){if(null!==e&&e.index+1!==t.index&&!s){s=Spicetify.Player.getProgress()-e.end;const n=t.start+s;this.logDebug(`Seek to: ${n}ms, from ${r}ms, with offset `+s);e=n>Spicetify.Player.getProgress();this.isSeekingResolver=e?e=>e>=n:e=>e<=n+1e3,this.logDebug(`Time to get there: ${Math.abs(Spicetify.Player.getProgress()-r)}ms`),await lt("PlayerAPI").seekTo(n)}}getNextBeat(e,t){if(null===this.currentBeat||t){for(const r of this.songState.graph.beats)if(e>=r.start&&e<=r.end)return r;return this.songState.graph.beats[0]}return this.bouncing?(null===this.bounceSeed&&(this.bounceSeed=this.currentBeat,this.bounceCount=0),this.bounceCount++%2==1?this.selectNextNeighbor(this.bounceSeed):this.bounceSeed):null!=this.bounceSeed?(t=this.bounceSeed,this.bounceSeed=null,t):(t=this.currentBeat.index+1)>=this.songState.graph.beats.length?(this.stop(),null):this.selectRandomNextBeat(this.songState.graph.beats[t])}selectRandomNextBeat(e){var t;return 0!==e.neighbours.length&&this.shouldRandomBranch(e)?(t=e.neighbours.shift(),e.neighbours.push(t),this.beatsSinceLastBranch=0,this.lastBranch=t,this.setLastBranchPlaying(!0),t.destination):e}setLastBranchPlaying(e){null!==this.lastBranch&&(this.lastBranch.isPlaying=e,this.lastBranch.source.isPlaying=e,this.lastBranch.destination.isPlaying=e)}selectNextNeighbor(e){var t;return 0===e.neighbours.length?e:(t=e.neighbours.shift(),e.neighbours.push(t),this.lastBranch=t,this.setLastBranchPlaying(!0),t.destination)}shouldRandomBranch(e){var t=(new Date).getTime()-this.songState.startTime;if(0<this.settings.maxJukeboxPlayTime&&t>this.settings.maxJukeboxPlayTime)return this.songState.currentRandomBranchChance=0,!1;if(e.index===this.songState.graph.lastBranchPoint&&this.settings.alwaysFollowLastBranch&&t<=this.settings.maxJukeboxPlayTime)return!0;if(this.beatsSinceLastBranch<=b.minBeatsBeforeBranching)return!1;this.songState.currentRandomBranchChance=Math.min(this.songState.currentRandomBranchChance+this.settings.randomBranchChanceDelta,this.settings.maxRandomBranchChance);e=Math.random()<this.songState.currentRandomBranchChance;return e&&(this.songState.currentRandomBranchChance=this.settings.minRandomBranchChance),e}stop(){this.playerSubscription.unsubscribe(),this.playerSubscription=new a,document.removeEventListener("keydown",this.onBounceKeyDown),document.removeEventListener("keyup",this.onBounceKeyUp)}logDebug(e){}},r(Re=Be=class{static get settings(){return b.fromPartial(Be.storedSettings)}static set settings(e){Be.storedSettings=e.toPartial()}static get storedSettings(){var e=Spicetify.LocalStorage.get(this.settingId);return null==e?(new b).toPartial():JSON.parse(e)}static set storedSettings(e){Spicetify.LocalStorage.set(this.settingId,JSON.stringify(e))}},"settingId","jukebox:settings"),v=class{constructor(e){this.api=e}async getRequest(e){return this.api.makeRequest("GET",e)}async postRequest(e,t,r=void 0){return this.api.makeRequest("POST",e,t,r)}async putRequest(e,t,r=void 0){return this.api.makeRequest("PUT",e,t,r)}async deleteRequest(e,t){return this.api.makeRequest("DELETE",e,t)}paramsFor(e){var t=new URLSearchParams;for(const r of Object.getOwnPropertyNames(e))(e[r]||0===e[r]||!e[r]&&"boolean"==typeof e[r])&&t.append(r,e[r].toString());return 0<[...t].length?"?"+t.toString():""}},Pe=class extends v{async get(e,t){if("string"==typeof e)return r=this.paramsFor({market:t}),await this.getRequest("albums/"+e+r);O("ids",e,1,20);var r=this.paramsFor({ids:e,market:t});return(await this.getRequest("albums"+r))?.albums??[]}async tracks(e,t,r,s){t=this.paramsFor({market:t,limit:r,offset:s});return this.getRequest(`albums/${e}/tracks`+t)}},qe=class extends v{async get(e){if("string"==typeof e)return await this.getRequest("artists/"+e);O("ids",e,1,50);e=this.paramsFor({ids:e});return(await this.getRequest("artists"+e))?.artists??[]}async albums(e,t,r,s,n){t=this.paramsFor({include_groups:t,market:r,limit:s,offset:n});return this.getRequest(`artists/${e}/albums`+t)}async topTracks(e,t){t=this.paramsFor({market:t});return this.getRequest(`artists/${e}/top-tracks`+t)}async relatedArtists(e){return this.getRequest(`artists/${e}/related-artists`)}},Ee=class extends v{async get(e,t){var r;return"string"==typeof e?(r=this.paramsFor({market:t}),this.getRequest("audiobooks/"+e+r)):(r=this.paramsFor({ids:e,market:t}),(await this.getRequest("audiobooks"+r))?.audiobooks??[])}async getAudiobookChapters(e,t,r,s){t=this.paramsFor({market:t,limit:r,offset:s});return this.getRequest(`audiobooks/${e}/chapters`+t)}},Ce=class extends v{async getCategories(e,t,r){e=this.paramsFor({locale:e,limit:t,offset:r});return this.getRequest("browse/categories"+e)}async getCategory(e,t){t=this.paramsFor({locale:t});return this.getRequest("browse/categories/"+e+t)}async getNewReleases(e,t){e=this.paramsFor({limit:e,offset:t});return this.getRequest("browse/new-releases"+e)}async getFeaturedPlaylists(e,t,r){e=this.paramsFor({locale:e,limit:t,offset:r});return this.getRequest("browse/featured-playlists"+e)}async getPlaylistsForCategory(e,t,r){t=this.paramsFor({limit:t,offset:r});return this.getRequest(`browse/categories/${e}/playlists`+t)}},_e=class extends v{async get(e,t){if("string"==typeof e)return r=this.paramsFor({market:t}),this.getRequest("chapters/"+e+r);O("ids",e,1,50);var r=this.paramsFor({ids:e,market:t});return(await this.getRequest("chapters"+r))?.chapters??[]}},Fe=class extends v{async get(e,t){if("string"==typeof e)return r=this.paramsFor({market:t}),this.getRequest("episodes/"+e+r);O("ids",e,1,50);var r=this.paramsFor({ids:e,market:t});return(await this.getRequest("episodes"+r))?.episodes??[]}},Te=class extends v{async get(e){e=this.paramsFor(e);return this.getRequest("recommendations"+e)}async genreSeeds(){return this.getRequest("recommendations/available-genre-seeds")}},De=class extends v{async getAvailableMarkets(){return this.getRequest("markets")}},je=class extends v{async getPlaybackState(e,t){e=this.paramsFor({market:e,additional_types:t});return this.getRequest("me/player"+e)}async getAvailableDevices(){return this.getRequest("me/player/devices")}async getCurrentlyPlayingTrack(e,t){e=this.paramsFor({market:e,additional_types:t});return this.getRequest("me/player/currently-playing"+e)}async getRecentlyPlayedTracks(e,t){e={limit:e},t&&("before"===t.type?e.before=t.timestamp:"after"===t.type&&(e.after=t.timestamp)),t=this.paramsFor(e);return this.getRequest("me/player/recently-played"+t)}async getUsersQueue(){return this.getRequest("me/player/queue")}async transferPlayback(e,t){if(1<e.length)throw new Error("Although an array is accepted, only a single device_id is currently supported. Supplying more than one will return 400 Bad Request");await this.putRequest("me/player",{device_ids:e,play:t})}async startResumePlayback(e,t,r,s,n){e=this.paramsFor({device_id:e});await this.putRequest("me/player/play"+e,{context_uri:t,uris:r,offset:s,positionMs:n})}async pausePlayback(e){e=this.paramsFor({device_id:e});await this.putRequest("me/player/pause"+e)}async skipToNext(e){e=this.paramsFor({device_id:e});await this.postRequest("me/player/next"+e)}async skipToPrevious(e){e=this.paramsFor({device_id:e});await this.postRequest("me/player/previous"+e)}async seekToPosition(e,t){e=this.paramsFor({position_ms:e,device_id:t});await this.putRequest("me/player/seek"+e)}async setRepeatMode(e,t){e=this.paramsFor({state:e,device_id:t});await this.putRequest("me/player/repeat"+e)}async setPlaybackVolume(e,t){e=this.paramsFor({volume_percent:e,device_id:t});await this.putRequest("me/player/volume"+e)}async togglePlaybackShuffle(e,t){e=this.paramsFor({state:e,device_id:t});await this.putRequest("me/player/shuffle"+e)}async addItemToPlaybackQueue(e,t){e=this.paramsFor({uri:e,device_id:t});await this.postRequest("me/player/queue"+e)}},Oe=class extends v{async getPlaylist(e,t,r,s){t=this.paramsFor({market:t,fields:r,additional_types:s?.join(",")});return this.getRequest("playlists/"+e+t)}async getPlaylistItems(e,t,r,s,n,a){t=this.paramsFor({market:t,fields:r,limit:s,offset:n,additional_types:a?.join(",")});return this.getRequest(`playlists/${e}/tracks`+t)}async changePlaylistDetails(e,t){await this.putRequest("playlists/"+e,t)}async movePlaylistItems(e,t,r,s){return this.updatePlaylistItems(e,{range_start:t,range_length:r,insert_before:s})}async updatePlaylistItems(e,t){return this.putRequest(`playlists/${e}/tracks`,t)}async addItemsToPlaylist(e,t,r){await this.postRequest(`playlists/${e}/tracks`,{position:r,uris:t})}async removeItemsFromPlaylist(e,t){await this.deleteRequest(`playlists/${e}/tracks`,t)}async getUsersPlaylists(e,t,r){t=this.paramsFor({limit:t,offset:r});return this.getRequest(`users/${e}/playlists`+t)}async createPlaylist(e,t){return this.postRequest(`users/${e}/playlists`,t)}async getPlaylistCoverImage(e){return this.getRequest(`playlists/${e}/images`)}async addCustomPlaylistCoverImage(e,t){let r="";if(t instanceof Buffer)r=t.toString("base64");else if(t instanceof HTMLCanvasElement)r=t.toDataURL("image/jpeg").split(";base64,")[1];else if(t instanceof HTMLImageElement){var s=document.createElement("canvas"),n=(s.width=t.width,s.height=t.height,s.getContext("2d"));if(!n)throw new Error("Could not get canvas context");n.drawImage(t,0,0),r=s.toDataURL("image/jpeg").split(";base64,")[1]}else{if("string"!=typeof t)throw new Error("ImageData must be a Buffer, HTMLImageElement, HTMLCanvasElement, or string containing a base64 encoded jpeg");r=t}await this.addCustomPlaylistCoverImageFromBase64String(e,r)}async addCustomPlaylistCoverImageFromBase64String(e,t){await this.putRequest(`playlists/${e}/images`,t,"image/jpeg")}},Ne=class extends v{async execute(e,t,r,s,n,a){e=this.paramsFor({q:e,type:t,market:r,limit:s,offset:n,include_external:a});return this.getRequest("search"+e)}},Ie=class extends v{async get(e,t){if("string"==typeof e)return r=this.paramsFor({market:t}),this.getRequest("shows/"+e+r);O("ids",e,1,50);var r=this.paramsFor({ids:e,market:t});return(await this.getRequest("shows"+r))?.shows??[]}async episodes(e,t,r,s){t=this.paramsFor({market:t,limit:r,offset:s});return this.getRequest(`shows/${e}/episodes`+t)}},Le=class extends v{async get(e,t){if("string"==typeof e)return r=this.paramsFor({market:t}),this.getRequest("tracks/"+e+r);O("ids",e,1,50);var r=this.paramsFor({ids:e,market:t});return(await this.getRequest("tracks"+r))?.tracks??[]}async audioFeatures(e){return"string"==typeof e?this.getRequest("audio-features/"+e):(e=this.paramsFor({ids:e}),(await this.getRequest("audio-features"+e))?.audio_features??[])}async audioAnalysis(e){return this.getRequest("audio-analysis/"+e)}},Ae=class{async getAccessToken(){return""}},$e=class extends v{async profile(e){return this.getRequest("users/"+e)}},Me=class extends v{albums;audiobooks;episodes;playlists;shows;tracks;constructor(e){super(e),this.albums=new ze(e),this.audiobooks=new Ue(e),this.episodes=new He(e),this.playlists=new Je(e),this.shows=new We(e),this.tracks=new Ge(e)}async profile(){return this.getRequest("me")}async topItems(e,t,r,s){t=this.paramsFor({time_range:t,limit:r,offset:s});return this.getRequest("me/top/"+e+t)}async followedArtists(e,t){e=this.paramsFor({type:"artist",after:e,limit:t});return this.getRequest("me/following"+e)}async followArtistsOrUsers(e,t){t=this.paramsFor({type:t});await this.putRequest("me/following"+t,{ids:e})}async unfollowArtistsOrUsers(e,t){t=this.paramsFor({type:t});await this.deleteRequest("me/following"+t,{ids:e})}async followsArtistsOrUsers(e,t){e=this.paramsFor({ids:e,type:t});return this.getRequest("me/following/contains"+e)}},ze=class extends v{async savedAlbums(e,t,r){e=this.paramsFor({limit:e,offset:t,market:r});return this.getRequest("me/albums"+e)}async saveAlbums(e){await this.putRequest("me/albums",e)}async removeSavedAlbums(e){await this.deleteRequest("me/albums",e)}async hasSavedAlbums(e){e=this.paramsFor({ids:e});return this.getRequest("me/albums/contains"+e)}},Ue=class extends v{async savedAudiobooks(e,t){e=this.paramsFor({limit:e,offset:t});return this.getRequest("me/audiobooks"+e)}async saveAudiobooks(e){await this.putRequest("me/audiobooks",e)}async removeSavedAudiobooks(e){await this.deleteRequest("me/audiobooks",e)}async hasSavedAudiobooks(e){e=this.paramsFor({ids:e});return this.getRequest("me/audiobooks/contains"+e)}},He=class extends v{async savedEpisodes(e,t,r){e=this.paramsFor({market:e,limit:t,offset:r});return this.getRequest("me/episodes"+e)}async saveEpisodes(e){await this.putRequest("me/episodes",e)}async removeSavedEpisodes(e){await this.deleteRequest("me/episodes",e)}async hasSavedEpisodes(e){e=this.paramsFor({ids:e});return this.getRequest("me/episodes/contains"+e)}},Je=class extends v{async playlists(e,t){e=this.paramsFor({limit:e,offset:t});return this.getRequest("me/playlists"+e)}async follow(e){await this.putRequest(`playlists/${e}/followers`)}async unfollow(e){await this.deleteRequest(`playlists/${e}/followers`)}async isFollowing(e,t){t=this.paramsFor({ids:t});return this.getRequest(`playlists/${e}/followers/contains`+t)}},We=class extends v{async savedShows(e,t){e=this.paramsFor({limit:e,offset:t});return this.getRequest("me/shows"+e)}async saveShows(e){e=this.paramsFor({ids:e});return this.putRequest("me/shows"+e)}async removeSavedShows(e,t){e=this.paramsFor({ids:e,market:t});return this.deleteRequest("me/shows"+e)}async hasSavedShow(e){e=this.paramsFor({ids:e});return this.getRequest("me/shows/contains"+e)}},Ge=class extends v{async savedTracks(e,t,r){e=this.paramsFor({limit:e,offset:t,market:r});return this.getRequest("me/tracks"+e)}async saveTracks(e){await this.putRequest("me/tracks",e)}async removeSavedTracks(e){await this.deleteRequest("me/tracks",e)}async hasSavedTracks(e){e=this.paramsFor({ids:e});return this.getRequest("me/tracks/contains"+e)}},Qe=class{async deserialize(e){e=await e.text();return 0<e.length?JSON.parse(e):null}},Ke=class{async validateResponse(e){switch(e.status){case 401:throw new Error("Bad or expired token. This can happen if the user revoked a token or the access token has expired. You should re-authenticate the user.");case 403:var t=await e.text();throw new Error("Bad OAuth request (wrong consumer key, bad nonce, expired timestamp...). Unfortunately, re-authenticating the user won't help here. Body: "+t);case 429:throw new Error("The app has exceeded its rate limits.");default:if(!e.status.toString().startsWith("20"))throw t=await e.text(),new Error(`Unrecognised response code: ${e.status} - ${e.statusText}. Body: `+t)}}},Ve=class{async handleErrors(e){return!1}},r(Xe=Ye=class{sdkConfig;albums;artists;audiobooks;browse;chapters;episodes;recommendations;markets;player;playlists;shows;tracks;users;search;currentUser;constructor(e){this.sdkConfig=this.initializeSdk(e),this.albums=new Pe(this),this.artists=new qe(this),this.audiobooks=new Ee(this),this.browse=new Ce(this),this.chapters=new _e(this),this.episodes=new Fe(this),this.recommendations=new Te(this),this.markets=new De(this),this.player=new je(this),this.playlists=new Oe(this),this.shows=new Ie(this),this.tracks=new Le(this),this.users=new $e(this),this.currentUser=new Me(this),this.search=new Ne(this)}async makeRequest(e,t,r=void 0,s=void 0){try{var n,a,i,o,c=await this.sdkConfig.authentication.getAccessToken();return null===c?(console.warn("No access token found."),null):(n=Ye.rootUrl+t,a={"Content-Type":s??"application/json"},""!==c&&(a.Authorization="Bearer "+c),i={method:e,headers:a,body:r?"string"==typeof r?r:JSON.stringify(r):void 0},this.sdkConfig.beforeRequest(n,i),o=await this.sdkConfig.fetch(n,i),this.sdkConfig.afterRequest(n,i,o),204===o.status?null:(await this.sdkConfig.responseValidator.validateResponse(o),await this.sdkConfig.deserializer.deserialize(o)))}catch(e){if(await this.sdkConfig.errorHandler.handleErrors(e))return null;throw e}}initializeSdk(e){return{...{fetch:async(e,t)=>fetch(e,t),beforeRequest:(e,t)=>{},afterRequest:(e,t,r)=>{},deserializer:new Qe,responseValidator:new Ke,errorHandler:new Ve,authentication:new Ae},...e}}},"rootUrl","https://api.spotify.com/v1/"),Ze=class{async handleErrors(e){return console.log(e),!1}},rt=class{_songState=null;songStateSubject=new de(null);songState$=this.songStateSubject.asObservable();get songState(){return this._songState}set songState(e){this._songState=e,this.songStateSubject.next(e)}settings;driver=null;get isEnabled(){return this.stateChangedSubject.value}async setEnabled(e){e?await this.enable():this.disable()}songChangedSubscription=new a;driverProcessSubscription=new a;statsChangedSubject=new g;statsChanged$=this.statsChangedSubject.asObservable();stateChangedSubject=new de(!1);stateChanged$=this.stateChangedSubject.asObservable();constructor(){this.settings=Re.settings}async reloadSettings(){this.settings=Re.settings,this.isEnabled&&(this.stop(),await this.start())}async enable(){this.stateChangedSubject.next(!0);var e=$t(Spicetify.Player,"songchange").subscribe(()=>{this.stop(),this.start()});this.songChangedSubscription.add(e),await this.start()}disable(){this.stop(),this.songChangedSubscription.unsubscribe(),this.songChangedSubscription=new a,this.stateChangedSubject.next(!1)}stop(){this.driver?.stop(),this.driver=null,this.driverProcessSubscription.unsubscribe(),this.driverProcessSubscription=new a,this.songState=null}async start(){var t=Spicetify.Player.data.item;if(void 0!==t){Spicetify.showNotification("Fetching analysis for song...");var r=Spicetify.URI.fromString(t.uri);if(Spicetify.URI.isLocalTrack(r))this.disableWithError("No analysis available for local tracks.");else if(Spicetify.URI.isEpisode(r))this.disableWithError("No analysis available for shows.");else{r=Ht(r);if(null===r)this.disableWithError("Couldn't get track id.");else{var s=Jt();let e=null;try{e=await s.tracks.audioAnalysis(r)}catch{}null===e||0===e.beats.length?this.disableWithError("No analysis available for this track."):(s=new Y(e).remixTrack(),r=new Se(this.settings,s.beats).generateGraph(),this.songState=new X(t,s,r),this.driver=new ke(this.songState,this.settings),this.driverProcessSubscription.add(this.driver.onProgress$.subscribe(()=>{this.statsChangedSubject.next({beatsPlayed:this.songState?.beatsPlayed??0,currentRandomBranchChance:this.songState?.currentRandomBranchChance??0,listenTime:null!==this.songState?(new Date).getTime()-this.songState.startTime:0})})),this.driver.start())}}}}disableWithError(e){Spicetify.showNotification(e,!0),this.disable()}},w=t(s()),x=t(s()),st={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},et="Infinity",tt=[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]],(v=(0,x.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:s,className:n="",children:a,...i},o)=>(0,x.createElement)("svg",{ref:o,...st,width:t,height:t,stroke:e,strokeWidth:s?24*Number(r)/Number(t):r,className:["lucide","lucide-"+et.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),n].join(" "),...i},[...tt.map(([e,t])=>(0,x.createElement)(e,t)),...Array.isArray(a)?a:[a]]))).displayName=""+et,nt=v,S=t(s(),1),at=(()=>"undefined"==typeof window?S.useEffect:S.useLayoutEffect)(),it=e=>e[1]?.next?e[1]:{next:e[1],error:e[2],complete:e[3]},ot=t(s()),(async()=>{for(window.jukebox=new rt;!Spicetify?.Platform;)await new Promise(e=>setTimeout(e,100));await 0;let e=null;try{e=await ht(".player-controls__right")}catch{}if(null===e)try{var t=await ht(".main-repeatButton-button");e=t.parentElement}catch{}try{if(null===e)throw new Error("Container element not found");var r=document.createElement("style");r.innerText=`
        button.jukebox-toggle {
            border-color: var(--text-base);
        }

        button.jukebox-toggle.active {
            color: var(--spice-button-active);
        }

        button.jukebox-toggle:focus-visible {
            border-width: 2px;
            border-style: solid;
        }

        button.jukebox-toggle:focus::after {
            border-color: transparent !important;
        }

        button.jukebox-toggle.active:before {
            background-color: currentcolor;
            border-radius: 50%;
            bottom: 0;
            content: "";
            display: block;
            left: 50%;
            position: absolute;
            width: 4px;
            inline-size: 4px;
            height: 4px;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
        }
    `,document.head.appendChild(r),s=ot.default.createElement(Gt,{className:"jukebox-toggle"}),n=e,a=Spicetify.ReactDOM.createRoot(document.createElement("div")),s=Spicetify.ReactDOM.createPortal(s,n),a.render(s),async function(e,r){var s=await ut("History");const n=async()=>{await dt(e,r)||Spicetify.showNotification("ðŸ“¢ A new version of the custom app is available.",!1,5e3)};if(s.location.pathname==="/"+r)await n();else{let t=null;t=s.listen(async e=>{e.pathname==="/"+r&&(await n(),t?.())})}}("1.0.0-beta.4","eternal-jukebox")}catch(e){console.error(e),Spicetify.showNotification("Failed to register the eternal jukebox playbar button",!0)}var s,n,a})();function ct(e){return Spicetify.Platform?.[e]}async function ut(e){return async function(e){let t=e();for(;void 0===t;)await new Promise(e=>setTimeout(e,100)),t=e();return t}(()=>ct(e))}function lt(e){var t=ct(e);if(void 0===t)throw new Error(`Platform API "${e}" is not available`);return t}async function ht(n,a=5e3,i=null,o=!1){return new Promise((e,t)=>{let r=document.querySelector(n);if(null!==r)o&&console.log("found element in querySelector"),e(r);else{const s=new MutationObserver(()=>{null!==(r=document.querySelector(n))&&(o&&console.log("found element in observer"),e(r),s.disconnect())});null===i&&(i=document.body),s.observe(i,{childList:!0,subtree:!0}),setTimeout(()=>{null===r&&(o&&console.log("trying to find element from querySelector again"),s.disconnect(),null!==(r=document.querySelector(n))?e(r):t(new Error(`Couldn't find the element "${n}".`)))},a)}})}async function dt(e,t){t=await(await(await fetch(`https://raw.githubusercontent.com/Pithaya/spicetify-apps/main/custom-apps/${t}/package.json`)).json()).version;return Q(e,t,">=")}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function pt(e,i,o,c){return new(o=o||Promise)(function(r,t){function s(e){try{a(c.next(e))}catch(e){t(e)}}function n(e){try{a(c.throw(e))}catch(e){t(e)}}function a(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(s,n)}a((c=c.apply(e,i||[])).next())})}function ft(s,n){var a,i,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(r){return function(e){var t=[r,e];if(a)throw new TypeError("Generator is already executing.");for(;c=u&&t[u=0]?0:c;)try{if(a=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(o=0<(o=c.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3]))c.label=t[1];else if(6===t[0]&&c.label<o[1])c.label=o[1],o=t;else{if(!(o&&c.label<o[2])){o[2]&&c.ops.pop(),c.trys.pop();continue}c.label=o[2],c.ops.push(t)}}t=n.call(s,c)}catch(e){t=[6,e],i=0}finally{a=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function B(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&s>=e.length?void 0:e)&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function R(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,a=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(s=a.next()).done;)i.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}function P(e,t,r){if(r||2===arguments.length)for(var s,n=0,a=t.length;n<a;n++)!s&&n in t||((s=s||Array.prototype.slice.call(t,0,n))[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function q(e){return this instanceof q?(this.v=e,this):new q(e)}function gt(e,t,r){var n,a,i;if(Symbol.asyncIterator)return n=r.apply(e,t||[]),a=[],i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;throw new TypeError("Symbol.asyncIterator is not defined.");function s(s){n[s]&&(i[s]=function(r){return new Promise(function(e,t){1<a.push([s,r,e,t])||o(s,r)})})}function o(e,t){try{(r=n[e](t)).value instanceof q?Promise.resolve(r.value.v).then(c,u):l(a[0][2],r)}catch(e){l(a[0][3],e)}var r}function c(e){o("next",e)}function u(e){o("throw",e)}function l(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}function yt(i){var e,t;if(Symbol.asyncIterator)return(e=i[Symbol.asyncIterator])?e.call(i):(i=B(i),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);throw new TypeError("Symbol.asyncIterator is not defined.");function r(a){t[a]=i[a]&&function(n){return new Promise(function(e,t){var r,s;n=i[a](n),r=e,e=t,s=n.done,t=n.value,Promise.resolve(t).then(function(e){r({value:e,done:s})},e)})}}}function E(e){return"function"==typeof e}function mt(e){e=e(function(e){Error.call(e),e.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e}function bt(e,t){e&&0<=(t=e.indexOf(t))&&e.splice(t,1)}function C(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}function vt(e){return e instanceof a||e&&"closed"in e&&E(e.remove)&&E(e.add)&&E(e.unsubscribe)}function wt(e){E(e)?e():e.unsubscribe()}function xt(t){i.setTimeout(function(){var e=n.onUnhandledError;if(!e)throw t;e(t)})}function St(){}function kt(e,t,r){return{kind:e,value:t,error:r}}function Bt(e){if(n.useDeprecatedSynchronousErrorHandling){var t=!c;if(t&&(c={errorThrown:!1,error:null}),e(),t){var t=c,r=t.errorThrown,t=t.error;if(c=null,r)throw t}}else e()}function _(e){var t=re.call(this)||this;return t.isStopped=!1,e?vt(t.destination=e)&&e.add(t):t.destination=ie,t}function Rt(e,t){return se.call(e,t)}function Pt(e){this.partialObserver=e}function qt(e,t,r){var s=ae.call(this)||this;return r=E(e)||!e?{next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=r?r:void 0}:s&&n.useDeprecatedNextContext?((t=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},{next:e.next&&Rt(e.next,t),error:e.error&&Rt(e.error,t),complete:e.complete&&Rt(e.complete,t)}):e,s.destination=new ne(r),s}function Et(e){var t;n.useDeprecatedSynchronousErrorHandling?(t=e,n.useDeprecatedSynchronousErrorHandling&&c&&(c.errorThrown=!0,c.error=t)):xt(e)}function Ct(e,t){var r=n.onStoppedNotification;r&&i.setTimeout(function(){return r(e,t)})}function _t(e){return e}function F(e){e&&(this._subscribe=e)}function Ft(e){return null!=(e=null!=e?e:n.Promise)?e:Promise}function Tt(r){return function(e){if(E(null==(t=e)?void 0:t.lift))return e.lift(function(e){try{return r(e,this)}catch(e){this.error(e)}});var t;throw new TypeError("Unable to lift unknown Observable type")}}function Dt(e,t,r,s,n){return new oe(e,t,r,s,n)}function jt(t,r,e,s,n,a){var i=f.call(this,t)||this;return i.onFinalize=n,i.shouldUnsubscribe=a,i._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:f.prototype._next,i._error=s?function(e){try{s(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:f.prototype._error,i._complete=e?function(){try{e()}catch(e){t.error(e)}finally{this.unsubscribe()}}:f.prototype._complete,i}function T(){var e=ce.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}function D(e,t){var r=le.call(this)||this;return r.destination=e,r.source=t,r}function j(e){var t=y.call(this)||this;return t._value=e,t}function Ot(e){if(e instanceof p)return e;if(null!=e){if(E(e[d]))return n=e,new p(function(e){var t=n[d]();if(E(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(pe(e))return s=e,new p(function(e){for(var t=0;t<s.length&&!e.closed;t++)e.next(s[t]);e.complete()});if(E(null==(t=e)?void 0:t.then))return r=e,new p(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,xt)});if(t=e,Symbol.asyncIterator&&E(null==t?void 0:t[Symbol.asyncIterator]))return Nt(e);if(E(null==(t=e)?void 0:t[fe]))return i=e,new p(function(e){var t,r;try{for(var s=B(i),n=s.next();!n.done;n=s.next()){var a=n.value;if(e.next(a),e.closed)return}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}e.complete()});if(E(null==(t=e)?void 0:t.getReader))return Nt(function(n){return gt(this,arguments,function(){var t,r,s;return ft(this,function(e){switch(e.label){case 0:t=n.getReader(),e.label=1;case 1:e.trys.push([1,,9,10]),e.label=2;case 2:return[4,q(t.read())];case 3:return(r=e.sent(),s=r.value,r.done)?[4,q(void 0)]:[3,5];case 4:return[2,e.sent()];case 5:return[4,q(s)];case 6:return[4,e.sent()];case 7:return e.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}(e))}var i,r,s,n,t;throw t=e,new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Nt(e){return new p(function(t){!function(r,s){var n,a,i,o;return pt(this,void 0,void 0,function(){var t;return ft(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,11]),n=yt(r),e.label=1;case 1:return[4,n.next()];case 2:if((a=e.sent()).done)return[3,4];if(t=a.value,s.next(t),s.closed)return[2];e.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return t=e.sent(),i={error:t},[3,11];case 6:return(e.trys.push([6,,9,10]),a&&!a.done&&(o=n.return))?[4,o.call(n)]:[3,8];case 7:e.sent(),e.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return s.complete(),[2]}})})}(e,t).catch(function(e){return t.error(e)})})}function It(s,n){return Tt(function(e,t){var r=0;e.subscribe(Dt(t,function(e){t.next(s.call(n,e,r++))}))})}function Lt(r){return It(function(e){return t=r,ge(e=e)?t.apply(void 0,P([],R(e))):t(e);var t})}function At(e,i,r,s,n,a,o,t){var c=[],u=0,l=0,h=function(){c.length||u||i.complete()},d=function(e){return u<s?p(e):c.push(e)},p=function(e){a&&i.next(e),u++;var t=!1;Ot(r(e,l++)).subscribe(Dt(i,function(e){null!=n&&n(e),a?d(e):i.next(e)},function(){t=!0},void 0,function(){if(t)try{u--;for(;c.length&&u<s;)!function(){var e,t,r,s,n,a=c.shift();o?(e=i,r=function(){p(a)},void 0===s&&(s=0),void 0===n&&(n=!1),t=(t=o).schedule(function(){r(),n?e.add(this.schedule(null,s)):this.unsubscribe()},s),e.add(t)):p(a)}();h()}catch(e){i.error(e)}}))};return e.subscribe(Dt(i,d,function(){h()})),function(){null!=t&&t()}}function $t(r,s,n,e){if(E(n)&&(e=n,n=void 0),e)return $t(r,s,n).pipe(Lt(e));var e=R(E((e=r).addEventListener)&&E(e.removeEventListener)?me.map(function(t){return function(e){return r[t](s,e,n)}}):E((e=r).addListener)&&E(e.removeListener)?ye.map(Mt(r,s)):E((e=r).on)&&E(e.off)?be.map(Mt(r,s)):[],2),t=e[0],a=e[1];if(!t&&pe(r))return function e(n,a,r){return void 0===r&&(r=1/0),E(a)?e(function(r,s){return It(function(e,t){return a(r,e,s,t)})(Ot(n(r,s)))},r):("number"==typeof a&&(r=a),Tt(function(e,t){return At(e,t,n,r)}))}(function(e){return $t(e,s,n)})(Ot(r));if(t)return new p(function(r){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.next(1<e.length?e:e[0])}return t(e),function(){return a(e)}});throw new TypeError("Invalid event target")}function Mt(r,s){return function(t){return function(e){return r[t](s,e)}}}function zt(a,i){return void 0===i&&(i=_t),a=null!=a?a:Ut,Tt(function(e,r){var s,n=!0;e.subscribe(Dt(r,function(e){var t=i(e);!n&&a(s,t)||(n=!1,s=t,r.next(e))}))})}function Ut(e,t){return e===t}function Ht(e){return e._base62Id??e.id??null}function O(e,t,r,s){if(!function(e,t,r){return void 0===e||t<=e&&e<=r}(t.length,r,s))throw new Error(e+` must have between ${r} and ${s} items`)}function Jt(){return new Xe({errorHandler:new Ze,fetch:async(e,t)=>{if("GET"!==t.method)throw new Error("Only GET requests are supported");return Spicetify.CosmosAsync.get(e)},responseValidator:{validateResponse:async e=>{var t;if("Failed to fetch"===e.message)throw{code:e,error:t}=e,new Error(`Failed to fetch: ${e} - `+t)}},deserializer:{deserialize:async e=>e}})}function Wt(e,t,r,s){{var n=S.useEffect,a=[e,t,r,s];const i=(0,S.useRef)(a),o=(0,S.useRef)(),c=(0,S.useRef)();at(()=>{i.current=a,o.current=it(a)}),n(()=>{const t=i.current[0],e=(o.current||(o.current=it(i.current)),t.subscribe({next:e=>{t===i.current[0]&&o.current.next?.(e)},error:e=>{t===i.current[0]&&(o.current.error?o.current:console).error(e)},complete:()=>{t===i.current[0]&&o.current.complete?.()}}));return c.current=e,()=>{e.unsubscribe()}},[a[0]]),c}}function Gt(e){var[t,r]=(0,w.useState)(!1);Wt(window.jukebox.stateChanged$,r);r=t?"Disable jukebox":"Enable jukebox";return w.default.createElement(Spicetify.ReactComponent.TooltipWrapper,{label:r,showDelay:100,renderInline:!1},w.default.createElement(Spicetify.ReactComponent.ButtonTertiary,{"aria-label":r,buttonSize:"sm",onClick:async e=>{e.stopPropagation(),await window.jukebox.setEnabled(!window.jukebox.isEnabled)},iconOnly:()=>w.default.createElement(nt,{size:24}),className:Spicetify.classnames(e.className,{active:t})}))}}();