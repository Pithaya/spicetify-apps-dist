!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(e=>setTimeout(e,10));var A,D,L,M,$,F,z,U,e,t,V,q,K,W,J,H,Y,G,Q,X,ee,te,re,ne,ae,se,ie,oe,s,ce,a,ue,de,n,le,he,pe,fe,me,ve,ye,ge,o,be,_e,xe,we,ke,Se,Te,Be,Ce,Oe,Ee,Ze,Pe,Ne,je,Re,Ie,Ae,De,l,i,Le,Me,$e,Fe,ze,d,Ue,Ve,qe,Ke,v,h,y,u,We,Je,He,c,g,b,Ye,p,Ge,Qe,Xe,et,_,tt,rt,f,nt,at,st,it,ot,ct,ut,dt,lt,ht,pt,ft,mt,vt,yt,gt,m,bt,_t,xt,wt,kt,St,Tt,Bt,Ct,x,Ot,w,k,Et,S,Zt,Pt,T,Nt,jt,Rt,It,At,Dt,Lt,Mt,$t,Ft,zt,B,C,Ut,Vt,qt,Kt,Wt,Jt,Ht,O,Yt,Gt,r,Qt,Xt,er,tr,rr,nr,ar,sr,ir,or,cr,ur,dr,lr,hr,pr,fr,mr,vr,yr,gr,br,_r,xr,wr,kr,Sr;L=Object.create,M=Object.defineProperty,$=Object.getOwnPropertyDescriptor,F=Object.getOwnPropertyNames,z=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty,e=(e,t,r)=>{r=null!=e?L(z(e)):{};var n=!t&&e&&e.__esModule?r:M(r,"default",{value:e,enumerable:!0}),a=e,s=void 0,i=void 0;if(a&&"object"==typeof a||"function"==typeof a)for(let e of F(a))U.call(n,e)||e===s||M(n,e,{get:()=>a[e],enumerable:!(i=$(a,e))||i.enumerable});return n},t=(e,t,r)=>{var n;return n=r,(t="symbol"!=typeof t?t+"":t)in(e=e)?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,r},A={"external-global-plugin:react"(e,t){t.exports=Spicetify.React}},V=function(){return D||(0,A[F(A)[0]])((D={exports:{}}).exports,D),D.exports},q=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,K=e=>{if("string"!=typeof e)throw new TypeError("Invalid argument expected string");var t=e.match(q);if(t)return t.shift(),t;throw new Error(`Invalid argument not valid semver ('${e}' received)`)},W=e=>"*"===e||"x"===e||"X"===e,J=e=>{var t=parseInt(e,10);return isNaN(t)?e:t},H=(e,t)=>{return W(e)||W(t)?0:([e,t]=(e=J(e),t=J(t),typeof e!=typeof t?[String(e),String(t)]:[e,t]),t<e?1:e<t?-1:0)},Y=(t,r)=>{for(let e=0;e<Math.max(t.length,r.length);e++){var n=H(t[e]||"0",r[e]||"0");if(0!==n)return n}return 0},G=(e,t,r)=>{var n=r;if("string"!=typeof n)throw new TypeError("Invalid operator type, expected string but got "+typeof n);if(-1===X.indexOf(n))throw new Error("Invalid operator, expected one of "+X.join("|"));n=t,t=K(t=e),n=K(n),e=t.pop(),a=n.pop();var a,n=0!==(t=Y(t,n))?t:e&&a?Y(e.split("."),a.split(".")):e||a?e?-1:1:0;return Q[r].includes(n)},Q={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},X=Object.keys(Q),re=e(V()),ne=e(V()),ae={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},ee="Infinity",te=[["path",{d:"M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z",key:"1z0uae"}]],(r=(0,ne.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:a="",children:s,...i},o)=>(0,ne.createElement)("svg",{ref:o,...ae,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:["lucide","lucide-"+ee.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),a].join(" "),...i},[...te.map(([e,t])=>(0,ne.createElement)(e,t)),...Array.isArray(s)?s:[s]]))).displayName=""+ee,se=r,ie=function(e,t){return(ie=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}))(e,t)},oe=Dr(function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}),Z.prototype.unsubscribe=function(){var t,e,r;if(!this.closed){this.closed=!0;var n=this._parentage;if(n)if(this._parentage=null,Array.isArray(n))try{for(var a=Pr(n),s=a.next();!s.done;s=a.next())s.value.remove(this)}catch(e){o={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}else n.remove(this);var i=this.initialTeardown;if(E(i))try{i()}catch(e){r=e instanceof oe?e.errors:[e]}var o=this._finalizers;if(o){this._finalizers=null;try{for(var c=Pr(o),u=c.next();!u.done;u=c.next()){var d=u.value;try{$r(d)}catch(e){r=null!=r?r:[],e instanceof oe?r=jr(jr([],Nr(r)),Nr(e.errors)):r.push(e)}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}}if(r)throw new oe(r)}},Z.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)$r(e);else{if(e instanceof Z){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(t=this._finalizers)?t:[]).push(e)}},Z.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},Z.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},Z.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Lr(t,e)},Z.prototype.remove=function(e){var t=this._finalizers;t&&Lr(t,e),e instanceof Z&&e._removeParent(this)},Z.EMPTY=((r=new Z).closed=!0,r),ce=(s=Z).EMPTY,a={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ue={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=ue.delegate;return null!=a&&a.setTimeout?a.setTimeout.apply(a,jr([e,t],Nr(r))):setTimeout.apply(void 0,jr([e,t],Nr(r)))},clearTimeout:function(e){var t=ue.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0},de=Ur("C",void 0,void 0),n=null,Or(P,le=s),P.create=function(e,t,r){return new ve(e,t,r)},P.prototype.next=function(e){this.isStopped?Hr(Ur("N",e,void 0),this):this._next(e)},P.prototype.error=function(e){this.isStopped?Hr(Ur("E",void 0,e),this):(this.isStopped=!0,this._error(e))},P.prototype.complete=function(){this.isStopped?Hr(de,this):(this.isStopped=!0,this._complete())},P.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,le.prototype.unsubscribe.call(this),this.destination=null)},P.prototype._next=function(e){this.destination.next(e)},P.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},P.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},he=P,pe=Function.prototype.bind,Kr.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Jr(e)}},Kr.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Jr(e)}else Jr(e)},Kr.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Jr(e)}},fe=Kr,Or(Wr,me=he),ve=Wr,ye={closed:!0,next:zr,error:function(e){throw e},complete:zr},ge="function"==typeof Symbol&&Symbol.observable||"@@observable",N.prototype.lift=function(e){var t=new N;return t.source=this,t.operator=e,t},N.prototype.subscribe=function(e,t,r){var n,a=this,s=(n=e)&&n instanceof he||function(e){return e&&E(e.next)&&E(e.error)&&E(e.complete)}(n)&&Mr(n)?e:new ve(e,t,r);return Vr(function(){var e=a.operator,t=a.source;s.add(e?e.call(s,t):t?a._subscribe(s):a._trySubscribe(s))}),s},N.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},N.prototype.forEach=function(n,e){var a=this;return new(e=Gr(e))(function(e,t){var r=new ve({next:function(e){try{n(e)}catch(e){t(e),r.unsubscribe()}},error:t,complete:e});a.subscribe(r)})},N.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},N.prototype[ge]=function(){return this},N.prototype.pipe=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(0===(t=e).length?Yr:1===t.length?t[0]:function(e){return t.reduce(function(e,t){return t(e)},e)})(this)},N.prototype.toPromise=function(e){var n=this;return new(e=Gr(e))(function(e,t){var r;n.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})},N.create=function(e){return new N(e)},o=N,Or(en,be=he),en.prototype.unsubscribe=function(){var e;this.shouldUnsubscribe&&!this.shouldUnsubscribe()||(e=this.closed,be.prototype.unsubscribe.call(this),e)||null==(e=this.onFinalize)||e.call(this)},_e=en,we=Dr(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Or(j,xe=o),j.prototype.lift=function(e){var t=new Te(this,this);return t.operator=e,t},j.prototype._throwIfClosed=function(){if(this.closed)throw new we},j.prototype.next=function(a){var s=this;Vr(function(){var t,e;if(s._throwIfClosed(),!s.isStopped){s.currentObservers||(s.currentObservers=Array.from(s.observers));try{for(var r=Pr(s.currentObservers),n=r.next();!n.done;n=r.next())n.value.next(a)}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}}})},j.prototype.error=function(t){var r=this;Vr(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var e=r.observers;e.length;)e.shift().error(t)}})},j.prototype.complete=function(){var t=this;Vr(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}})},j.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(j.prototype,"observed",{get:function(){var e;return 0<(null==(e=this.observers)?void 0:e.length)},enumerable:!1,configurable:!0}),j.prototype._trySubscribe=function(e){return this._throwIfClosed(),xe.prototype._trySubscribe.call(this,e)},j.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},j.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,n=this.isStopped,a=this.observers;return r||n?ce:(this.currentObservers=null,a.push(e),new s(function(){t.currentObservers=null,Lr(a,e)}))},j.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,n=this.isStopped;t?e.error(r):n&&e.complete()},j.prototype.asObservable=function(){var e=new o;return e.source=this,e},j.create=function(e,t){return new Te(e,t)},Or(tn,Se=ke=j),tn.prototype.next=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.next)&&r.call(t,e)},tn.prototype.error=function(e){var t,r;null!=(r=null==(t=this.destination)?void 0:t.error)&&r.call(t,e)},tn.prototype.complete=function(){var e,t;null!=(t=null==(e=this.destination)?void 0:e.complete)&&t.call(e)},tn.prototype._subscribe=function(e){var t;return null!=(t=null==(t=this.source)?void 0:t.subscribe(e))?t:ce},Te=tn,Or(rn,Be=ke),Object.defineProperty(rn.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),rn.prototype._subscribe=function(e){var t=Be.prototype._subscribe.call(this,e);return t.closed||e.next(this._value),t},rn.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},rn.prototype.next=function(e){Be.prototype.next.call(this,this._value=e)},Ce=rn,Oe=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},Ee="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Ze=Array.isArray,Pe=["addListener","removeListener"],Ne=["addEventListener","removeEventListener"],je=["on","off"],Re=e(V(),1),Ie=(()=>"undefined"==typeof window?Re.useEffect:Re.useLayoutEffect)(),Ae=e=>e[1]?.next?e[1]:{next:e[1],error:e[2],complete:e[3]},De=e(V()),Me=class{index;isPlaying=!1;next=null;previous=null;neighbours=[];start;duration;playCount=0;get end(){return this.start+this.duration}constructor(e,t,r){this.index=e,this.start=t,this.duration=r}toString(){return`[${this.index}]: ${this.start} - ${this.end} (${this.duration})`}isInBeat(e){return e>=this.start&&e<=this.end}},$e=class{get id(){return this.source.index+"-"+this.destination.index}source;destination;distance;isPlaying;deleted;constructor(e,t,r){this.source=e,this.destination=t,this.distance=r,this.isPlaying=!1,this.deleted=!1}},Fe=class{beats=[];lastBranchPoint=0;longestReach=0;constructor(e=[]){this.beats=e}},t(d=ze=class{maxBranchDistance=ze.defaultBranchDistance;useDynamicBranchDistance=!1;minRandomBranchChance=ze.defaultMinRandomBranchChance;maxRandomBranchChance=ze.defaultMaxRandomBranchChance;randomBranchChanceDelta=ze.defaultRandomBranchChanceDelta;maxJukeboxPlayTime=0;addLastEdge=!0;justBackwards=!1;justLongBranches=!1;removeSequentialBranches=!1;alwaysFollowLastBranch=!0;static fromPartial(e){var t=new ze;return t.maxBranchDistance=e.maxBranchDistance,t.useDynamicBranchDistance=e.useDynamicBranchDistance,t.minRandomBranchChance=e.minRandomBranchChance,t.maxRandomBranchChance=e.maxRandomBranchChance,t.randomBranchChanceDelta=e.randomBranchChanceDelta,t.addLastEdge=e.addLastEdge,t.justBackwards=e.justBackwards,t.justLongBranches=e.justLongBranches,t.removeSequentialBranches=e.removeSequentialBranches,t.alwaysFollowLastBranch=e.alwaysFollowLastBranch,t.maxJukeboxPlayTime=e.maxJukeboxPlayTime,t}toPartial(){return{maxBranchDistance:this.maxBranchDistance,useDynamicBranchDistance:this.useDynamicBranchDistance,minRandomBranchChance:this.minRandomBranchChance,maxRandomBranchChance:this.maxRandomBranchChance,randomBranchChanceDelta:this.randomBranchChanceDelta,addLastEdge:this.addLastEdge,justBackwards:this.justBackwards,justLongBranches:this.justLongBranches,removeSequentialBranches:this.removeSequentialBranches,alwaysFollowLastBranch:this.alwaysFollowLastBranch,maxJukeboxPlayTime:this.maxJukeboxPlayTime}}},"minBeatsBeforeBranching",5),t(d,"rangeMinBranchDistance",2),t(d,"rangeMaxBranchDistance",80),t(d,"defaultBranchDistance",30),t(d,"defaultMinRandomBranchChance",.18),t(d,"defaultMaxRandomBranchChance",.5),t(d,"minRandomBranchChanceDelta",0),t(d,"maxRandomBranchChanceDelta",.2),t(d,"defaultRandomBranchChanceDelta",.018),Ue=class{constructor(e,t){this.settings=e,this.beats=t,this.graph=new Fe,this.allNeighbours=t.map(()=>[]),this.minLongBranch=t.length/5}graph;allEdges=[];allNeighbours=[];minLongBranch=0;computedMaxBranchDistance=0;maxBranches=4;generateGraph(){var e,t,r=this.beats.map(e=>new Me(e.index,1e3*e.start,1e3*e.duration));for([e,t]of r.entries())e<r.length-1&&(t.next=r[e+1]),0<e&&(t.previous=r[e-1]);return this.graph=new Fe(r),this.precalculateNearestNeighbors(),this.settings.useDynamicBranchDistance?this.dynamicCollectNearestNeighbors():(this.collectNearestNeighbors(this.settings.maxBranchDistance),this.computedMaxBranchDistance=this.settings.maxBranchDistance),this.postProcessNearestNeighbors(),this.graph}dynamicCollectNearestNeighbors(){var e=this.beats.length/6;let t;for(t=10;t<d.rangeMaxBranchDistance&&!(e<=this.collectNearestNeighbors(t));t+=5);this.computedMaxBranchDistance=t}precalculateNearestNeighbors(){if(0===this.allEdges.length)for(const e of this.beats)this.calculateNearestNeighborsForBeat(e)}calculateNearestNeighborsForBeat(r){var e,n,t=this.maxBranches,a=d.rangeMaxBranchDistance,s=[];for([e,n]of this.beats.entries())if(e!==r.index){let t=0;for(var[i,o]of r.overlappingSegments.entries()){let e=100;i<n.overlappingSegments.length&&(i=n.overlappingSegments[i],e=o.index===i.index?100:this.getSegmentsDistance(o,i)),t+=e}var c=r.indexInParent===n.indexInParent?0:100,c=t/r.overlappingSegments.length+c;c<a&&(c=new $e(this.graph.beats[r.index],this.graph.beats[e],c),s.push(c))}s.sort((e,t)=>e.distance>t.distance?1:t.distance>e.distance?-1:0);for(let e=0;e<t&&e<s.length;e++){var u=s[e];this.allNeighbours[r.index].push(u),this.allEdges.push(u)}}getSegmentsDistance(e,t){return+this.getEuclideanDistance(e.timbre,t.timbre)+10*this.getEuclideanDistance(e.pitches,t.pitches)+ +Math.abs(e.loudness_start-t.loudness_start)+ +Math.abs(e.loudness_max-t.loudness_max)+100*Math.abs(e.duration-t.duration)+ +Math.abs(e.confidence-t.confidence)}getEuclideanDistance(t,r){let n=0;for(let e=0;e<t.length;e++){var a=r[e]-t[e];n+=a*a}return Math.sqrt(n)}collectNearestNeighbors(e){let t=0;for(var[r,n]of this.graph.beats.entries())n.neighbours=this.filterNearestNeighbors(r,e),0<n.neighbours.length&&(t+=1);return t}filterNearestNeighbors(t,r){return this.allNeighbours[t].filter(e=>!e.deleted&&!(this.settings.justBackwards&&e.destination.index>t||this.settings.justLongBranches&&Math.abs(e.destination.index-t)<this.minLongBranch)&&e.distance<=r)}postProcessNearestNeighbors(){this.settings.addLastEdge&&this.insertBestBackwardBranch(this.computedMaxBranchDistance,this.longestBackwardBranch()<50?65:55),this.graph.lastBranchPoint=this.findBestLastBeat(),this.filterOutBadBranches(),this.settings.removeSequentialBranches&&this.filterOutSequentialBranches()}longestBackwardBranch(){let e=0;for(const r of this.graph.beats)for(const n of r.neighbours){var t=r.index-n.destination.index;t>e&&(e=t)}return 100*e/this.beats.length}insertBestBackwardBranch(e,t){var r,n,a,s,i=[];for([r,n]of this.graph.beats.entries())for(const d of this.allNeighbours[r]){var o=d.destination.index,c=d.distance,u=r-o;0<u&&c<t&&(c=100*u/this.graph.beats.length,i.push({percentDistance:c,beatIndex:r,otherBeatIndex:o,currentBeat:n,edge:d}))}0!==i.length&&(i.sort((e,t)=>e.percentDistance-t.percentDistance),i.reverse(),s=(a=i[0]).currentBeat,e<(e=a.edge).distance)&&s.neighbours.push(e)}calculateReachability(){const r=this.graph.beats.map(()=>0);this.graph.beats.forEach((e,t)=>{r[t]=this.graph.beats.length-t});for(let e=0;e<1e3;e++){let t=0;for(var[n,a]of this.graph.beats.entries()){let e=!1;for(const i of a.neighbours){var s=r[i.destination.index];s>r[n]&&(r[n]=s,e=!0)}if(n<this.graph.beats.length-1&&(a=r[n+1])>r[n]&&(r[n]=a,e=!0),e){t++;for(let e=0;e<n;e++)r[e]<r[n]&&(r[e]=r[n])}}if(0===t)break}return r}findBestLastBeat(){var t=this.calculateReachability();let r=0,n=0;for(let e=this.graph.beats.length-1;0<=e;e--){var a=this.graph.beats[e],s=this.graph.beats.length-e,s=100*(t[e]-s)/this.beats.length;if(s>n&&0<a.neighbours.length&&(n=s,r=e,50<=s))break}return this.graph.longestReach=n,r}filterOutBadBranches(){const t=this.graph.lastBranchPoint;for(let e=0;e<t;e++){var r=this.graph.beats[e];r.neighbours=r.neighbours.filter(e=>e.destination.index<t)}}filterOutSequentialBranches(){for(let e=this.graph.beats.length-1;1<=e;e--){const t=this.graph.beats[e];t.neighbours=t.neighbours.filter(e=>!this.hasSequentialBranch(t,e))}}hasSequentialBranch(e,t){if(e.index!==this.graph.lastBranchPoint){var r=e.previous;if(null!==r){var n=e.index-t.destination.index;for(const a of r.neighbours)if(n==r.index-a.destination.index)return!0}}return!1}},Ve=class{analysis;constructor(e){e={bars:e.bars.map(e=>this.toRemixed(e)),beats:e.beats.map(e=>this.toRemixed(e)),sections:e.sections.map(e=>this.toRemixedSection(e)),segments:e.segments.map(e=>this.toRemixedSegment(e)),tatums:e.tatums.map(e=>this.toRemixed(e))};this.analysis=e}toRemixed(e){return{...e,firstOverlappingSegment:void 0,overlappingSegments:[],children:[],parent:void 0,indexInParent:0,prev:void 0,next:void 0,index:0}}toRemixedSection(e){return{...e,children:[],prev:void 0,next:void 0,index:0}}toRemixedSegment(e){return{...e,parent:void 0,indexInParent:0,prev:void 0,next:void 0,index:0}}remixTrack(){return this.preprocessTrack()}preprocessTrack(){for(const n of["sections","bars","beats","tatums","segments"]){var e,t,r=this.analysis[n];for([e,t]of r.entries())0<(t.index=e)?t.prev=r[e-1]:t.prev=null,e<r.length-1?t.next=r[e+1]:t.next=null}return this.connectQuanta(this.analysis.sections,this.analysis.bars),this.connectQuanta(this.analysis.bars,this.analysis.beats),this.connectQuanta(this.analysis.beats,this.analysis.tatums),this.connectQuanta(this.analysis.tatums,this.analysis.segments),this.connectFirstOverlappingSegment(this.analysis,this.analysis.bars),this.connectFirstOverlappingSegment(this.analysis,this.analysis.beats),this.connectFirstOverlappingSegment(this.analysis,this.analysis.tatums),this.connectAllOverlappingSegments(this.analysis,this.analysis.bars),this.connectAllOverlappingSegments(this.analysis,this.analysis.beats),this.connectAllOverlappingSegments(this.analysis,this.analysis.tatums),this.analysis}connectQuanta(e,t){let r=0;for(const a of e){a.children=[];for(let e=r;e<t.length;e++){var n=t[e];if(n.start>=a.start&&n.start<a.start+a.duration)n.parent=a,n.indexInParent=a.children.length,a.children.push(n),r=e;else if(n.start>a.start)break}}}connectFirstOverlappingSegment(e,t){let r=0;var n=e.segments;for(const s of t)for(let e=r;e<n.length;e++){var a=n[e];if(a.start>=s.start){s.firstOverlappingSegment=a,r=e;break}}}connectAllOverlappingSegments(e,t){let r=0;var n=e.segments;for(const s of t){s.overlappingSegments=[];for(let e=r;e<n.length;e++){var a=n[e];if(!(a.start+a.duration<s.start)){if(a.start>s.start+s.duration)break;r=e,s.overlappingSegments.push(a)}}}}},qe=class{beatsPlayed=0;startTime=0;track;analysis;graph;currentRandomBranchChance=0;constructor(e,t,r){this.track=e,this.analysis=t,this.graph=r,this.currentRandomBranchChance=window.jukebox.settings.minRandomBranchChance,this.startTime=(new Date).getTime()}},Ke="https://api.spotify.com/v1",(i=l=l||{}).assertEqual=e=>e,i.assertIs=function(e){},i.assertNever=function(e){throw new Error},i.arrayToEnum=e=>{var t={};for(const r of e)t[r]=r;return t},i.getValidEnumValues=t=>{var e={};for(const r of i.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]))e[r]=t[r];return i.objectValues(e)},i.objectValues=t=>i.objectKeys(t).map(function(e){return t[e]}),i.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{var t=[];for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},i.find=(e,t)=>{for(const r of e)if(t(r))return r},i.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,i.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},i.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(Le||(Le={})).mergeShapes=(e,t)=>({...e,...t}),v=l.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),h=e=>{switch(typeof e){case"undefined":return v.undefined;case"string":return v.string;case"number":return isNaN(e)?v.nan:v.number;case"boolean":return v.boolean;case"function":return v.function;case"bigint":return v.bigint;case"symbol":return v.symbol;case"object":return Array.isArray(e)?v.array:null===e?v.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?v.promise:"undefined"!=typeof Map&&e instanceof Map?v.map:"undefined"!=typeof Set&&e instanceof Set?v.set:"undefined"!=typeof Date&&e instanceof Date?v.date:v.object;default:return v.unknown}},y=l.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),(u=class extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};var t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const a=e||function(e){return e.message},s={_errors:[]},t=e=>{for(const n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(t);else if("invalid_return_type"===n.code)t(n.returnTypeError);else if("invalid_arguments"===n.code)t(n.argumentsError);else if(0===n.path.length)s._errors.push(a(n));else{let e=s,t=0;for(;t<n.path.length;){var r=n.path[t];t===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(a(n))):e[r]=e[r]||{_errors:[]},e=e[r],t++}}};return t(this),s}static assert(e){if(!(e instanceof u))throw new Error("Not a ZodError: "+e)}toString(){return this.message}get message(){return JSON.stringify(this.issues,l.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){var t={},r=[];for(const n of this.issues)(0<n.path.length?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]]):r).push(e(n));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}).create=e=>{return new u(e)},Je=We=(e,t)=>{let r;switch(e.code){case y.invalid_type:r=e.received===v.undefined?"Required":`Expected ${e.expected}, received `+e.received;break;case y.invalid_literal:r="Invalid literal value, expected "+JSON.stringify(e.expected,l.jsonStringifyReplacer);break;case y.unrecognized_keys:r="Unrecognized key(s) in object: "+l.joinValues(e.keys,", ");break;case y.invalid_union:r="Invalid input";break;case y.invalid_union_discriminator:r="Invalid discriminator value. Expected "+l.joinValues(e.options);break;case y.invalid_enum_value:r=`Invalid enum value. Expected ${l.joinValues(e.options)}, received '${e.received}'`;break;case y.invalid_arguments:r="Invalid function arguments";break;case y.invalid_return_type:r="Invalid function return type";break;case y.invalid_date:r="Invalid date";break;case y.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=r+" at one or more positions greater than or equal to "+e.validation.position)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:l.assertNever(e.validation):r="regex"!==e.validation?"Invalid "+e.validation:"Invalid";break;case y.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?"Number must be "+(e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than ")+e.minimum:"date"===e.type?"Date must be "+(e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than ")+new Date(Number(e.minimum)):"Invalid input";break;case y.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} `+e.maximum:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} `+e.maximum:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} `+new Date(Number(e.maximum)):"Invalid input";break;case y.custom:r="Invalid input";break;case y.invalid_intersection_types:r="Intersection results could not be merged";break;case y.not_multiple_of:r="Number must be a multiple of "+e.multipleOf;break;case y.not_finite:r="Number must be finite";break;default:r=t.defaultError,l.assertNever(e)}return{message:r}},He=e=>{var{data:t,path:e,errorMaps:r,issueData:n}=e,e=[...e,...n.path||[]],a={...n,path:e};if(void 0!==n.message)return{...n,path:e,message:n.message};let s="";for(const i of r.filter(e=>!!e).slice().reverse())s=i(a,{data:t,defaultError:s}).message;return{...n,path:e,message:s}},g=class{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){var r=[];for(const n of t){if("aborted"===n.status)return b;"dirty"===n.status&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){var r=[];for(const s of t){var n=await s.key,a=await s.value;r.push({key:n,value:a})}return g.mergeObjectSync(e,r)}static mergeObjectSync(e,t){var r={};for(const s of t){var{key:n,value:a}=s;if("aborted"===n.status)return b;if("aborted"===a.status)return b;"dirty"===n.status&&e.dirty(),"dirty"===a.status&&e.dirty(),"__proto__"===n.value||void 0===a.value&&!s.alwaysSet||(r[n.value]=a.value)}return{status:e.value,value:r}}},b=Object.freeze({status:"aborted"}),Ye=e=>({status:"dirty",value:e}),p=e=>({status:"valid",value:e}),Ge=e=>"aborted"===e.status,Qe=e=>"dirty"===e.status,Xe=e=>"valid"===e.status,et=e=>"undefined"!=typeof Promise&&e instanceof Promise,(r=c=c||{}).errToObj=e=>"string"==typeof e?{message:e}:e||{},r.toString=e=>"string"==typeof e?e:null==e?void 0:e.message,_=class{constructor(e,t,r,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},tt=(t,e)=>{if(Xe(e))return{success:!0,data:e.value};if(t.common.issues.length)return{success:!1,get error(){var e;return this._error||(e=new u(t.common.issues),this._error=e),this._error}};throw new Error("Validation failed but no issues detected.")},f=class{get description(){return this._def.description}_getType(e){return h(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:h(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new g,ctx:{common:e.parent.common,data:e.data,parsedType:h(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){e=this._parse(e);if(et(e))throw new Error("Synchronous parse encountered promise.");return e}_parseAsync(e){e=this._parse(e);return Promise.resolve(e)}parse(e,t){e=this.safeParse(e,t);if(e.success)return e.data;throw e.error}safeParse(e,t){var r={common:{issues:[],async:null!=(r=null==t?void 0:t.async)&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:h(e)},t=this._parseSync({data:e,path:r.path,parent:r});return tt(r,t)}"~validate"(e){const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:h(e)};if(!this["~standard"].async)try{var r=this._parseSync({data:e,path:[],parent:t});return Xe(r)?{value:r.value}:{issues:t.common.issues}}catch(e){null!=(r=null==(r=null==e?void 0:e.message)?void 0:r.toLowerCase())&&r.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>Xe(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){e=await this.safeParseAsync(e,t);if(e.success)return e.data;throw e.error}async safeParseAsync(e,t){t={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:h(e)},e=this._parse({data:e,path:t.path,parent:t}),e=await(et(e)?e:Promise.resolve(e));return tt(t,e)}refine(a,s){return this._refinement((t,r)=>{var e=a(t);const n=()=>{return r.addIssue({code:y.custom,...(e=t,"string"==typeof s||void 0===s?{message:s}:"function"==typeof s?s(e):s)});var e};return"undefined"!=typeof Promise&&e instanceof Promise?e.then(e=>!!e||(n(),!1)):!!e||(n(),!1)})}refinement(r,n){return this._refinement((e,t)=>!!r(e)||(t.addIssue("function"==typeof n?n(e,t):n),!1))}_refinement(e){return new B({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return C.create(this,this._def)}nullable(){return Ut.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return w.create(this)}promise(){return zt.create(this,this._def)}or(e){return Et.create([this,e],this._def)}and(e){return Pt.create(this,e,this._def)}transform(e){return new B({...I(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){var t="function"==typeof e?e:()=>e;return new Vt({...I(this._def),innerType:this,defaultValue:t,typeName:O.ZodDefault})}brand(){return new Wt({typeName:O.ZodBranded,type:this,...I(this._def)})}catch(e){var t="function"==typeof e?e:()=>e;return new qt({...I(this._def),innerType:this,catchValue:t,typeName:O.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return Jt.create(this,e)}readonly(){return Ht.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},nt=/^c[^\s-]{8,}$/i,at=/^[0-9a-z]+$/,st=/^[0-9A-HJKMNP-TV-Z]{26}$/i,it=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ot=/^[a-z0-9_-]{21}$/i,ct=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ut=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,dt=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,lt=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ht=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,pt=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ft=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,mt=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,vt=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,yt="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",gt=new RegExp(`^${yt}$`),(m=class extends f{_parse(t){var e;if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==v.string)return R(e=this._getOrReturnCtx(t),{code:y.invalid_type,expected:v.string,received:e.parsedType}),b;var r=new g;let n=void 0;for(const i of this._def.checks)if("min"===i.kind)t.data.length<i.value&&(R(n=this._getOrReturnCtx(t,n),{code:y.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("max"===i.kind)t.data.length>i.value&&(R(n=this._getOrReturnCtx(t,n),{code:y.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if("length"===i.kind){var a=t.data.length>i.value,s=t.data.length<i.value;(a||s)&&(n=this._getOrReturnCtx(t,n),a?R(n,{code:y.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):s&&R(n,{code:y.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if("email"===i.kind)dt.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"email",code:y.invalid_string,message:i.message}),r.dirty());else if("emoji"===i.kind)(rt=rt||new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")).test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"emoji",code:y.invalid_string,message:i.message}),r.dirty());else if("uuid"===i.kind)it.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"uuid",code:y.invalid_string,message:i.message}),r.dirty());else if("nanoid"===i.kind)ot.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"nanoid",code:y.invalid_string,message:i.message}),r.dirty());else if("cuid"===i.kind)nt.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"cuid",code:y.invalid_string,message:i.message}),r.dirty());else if("cuid2"===i.kind)at.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"cuid2",code:y.invalid_string,message:i.message}),r.dirty());else if("ulid"===i.kind)st.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"ulid",code:y.invalid_string,message:i.message}),r.dirty());else if("url"===i.kind)try{new URL(t.data)}catch(e){R(n=this._getOrReturnCtx(t,n),{validation:"url",code:y.invalid_string,message:i.message}),r.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"regex",code:y.invalid_string,message:i.message}),r.dirty())):"trim"===i.kind?t.data=t.data.trim():"includes"===i.kind?t.data.includes(i.value,i.position)||(R(n=this._getOrReturnCtx(t,n),{code:y.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):"toLowerCase"===i.kind?t.data=t.data.toLowerCase():"toUpperCase"===i.kind?t.data=t.data.toUpperCase():"startsWith"===i.kind?t.data.startsWith(i.value)||(R(n=this._getOrReturnCtx(t,n),{code:y.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):"endsWith"===i.kind?t.data.endsWith(i.value)||(R(n=this._getOrReturnCtx(t,n),{code:y.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):"datetime"===i.kind?_n(i).test(t.data)||(R(n=this._getOrReturnCtx(t,n),{code:y.invalid_string,validation:"datetime",message:i.message}),r.dirty()):"date"===i.kind?gt.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{code:y.invalid_string,validation:"date",message:i.message}),r.dirty()):"time"===i.kind?bn(i).test(t.data)||(R(n=this._getOrReturnCtx(t,n),{code:y.invalid_string,validation:"time",message:i.message}),r.dirty()):"duration"===i.kind?ut.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"duration",code:y.invalid_string,message:i.message}),r.dirty()):"ip"===i.kind?xn(t.data,i.version)||(R(n=this._getOrReturnCtx(t,n),{validation:"ip",code:y.invalid_string,message:i.message}),r.dirty()):"jwt"===i.kind?wn(t.data,i.alg)||(R(n=this._getOrReturnCtx(t,n),{validation:"jwt",code:y.invalid_string,message:i.message}),r.dirty()):"cidr"===i.kind?kn(t.data,i.version)||(R(n=this._getOrReturnCtx(t,n),{validation:"cidr",code:y.invalid_string,message:i.message}),r.dirty()):"base64"===i.kind?mt.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"base64",code:y.invalid_string,message:i.message}),r.dirty()):"base64url"===i.kind?vt.test(t.data)||(R(n=this._getOrReturnCtx(t,n),{validation:"base64url",code:y.invalid_string,message:i.message}),r.dirty()):l.assertNever(i);return{status:r.value,value:t.data}}_regex(t,e,r){return this.refinement(e=>t.test(e),{validation:e,code:y.invalid_string,...c.errToObj(r)})}_addCheck(e){return new m({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...c.errToObj(e)})}url(e){return this._addCheck({kind:"url",...c.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...c.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...c.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...c.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...c.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...c.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...c.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...c.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...c.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...c.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...c.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...c.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!=(t=null==e?void 0:e.offset)&&t,local:null!=(t=null==e?void 0:e.local)&&t,...c.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...c.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...c.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...c.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...c.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...c.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...c.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...c.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...c.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...c.errToObj(t)})}nonempty(e){return this.min(1,c.errToObj(e))}trim(){return new m({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new m({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new m({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}).create=e=>{var t;return new m({checks:[],typeName:O.ZodString,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...I(e)})},(bt=class extends f{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){var t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==v.number)return R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.number,received:t.parsedType}),b;let r=void 0;var n=new g;for(const a of this._def.checks)"int"===a.kind?l.isInteger(e.data)||(R(r=this._getOrReturnCtx(e,r),{code:y.invalid_type,expected:"integer",received:"float",message:a.message}),n.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(R(r=this._getOrReturnCtx(e,r),{code:y.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(R(r=this._getOrReturnCtx(e,r),{code:y.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),n.dirty()):"multipleOf"===a.kind?0!==Sn(e.data,a.value)&&(R(r=this._getOrReturnCtx(e,r),{code:y.not_multiple_of,multipleOf:a.value,message:a.message}),n.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(R(r=this._getOrReturnCtx(e,r),{code:y.not_finite,message:a.message}),n.dirty()):l.assertNever(a);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,c.toString(t))}gt(e,t){return this.setLimit("min",e,!1,c.toString(t))}lte(e,t){return this.setLimit("max",e,!0,c.toString(t))}lt(e,t){return this.setLimit("max",e,!1,c.toString(t))}setLimit(e,t,r,n){return new bt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:c.toString(n)}]})}_addCheck(e){return new bt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:c.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:c.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:c.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:c.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:c.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:c.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:c.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:c.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:c.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&l.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}).create=e=>new bt({checks:[],typeName:O.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...I(e)}),(_t=class extends f{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch(e){return this._getInvalidInput(t)}if(this._getType(t)!==v.bigint)return this._getInvalidInput(t);let e=void 0;var r=new g;for(const n of this._def.checks)"min"===n.kind?(n.inclusive?t.data<n.value:t.data<=n.value)&&(R(e=this._getOrReturnCtx(t,e),{code:y.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"max"===n.kind?(n.inclusive?t.data>n.value:t.data>=n.value)&&(R(e=this._getOrReturnCtx(t,e),{code:y.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),r.dirty()):"multipleOf"===n.kind?t.data%n.value!==BigInt(0)&&(R(e=this._getOrReturnCtx(t,e),{code:y.not_multiple_of,multipleOf:n.value,message:n.message}),r.dirty()):l.assertNever(n);return{status:r.value,value:t.data}}_getInvalidInput(e){e=this._getOrReturnCtx(e);return R(e,{code:y.invalid_type,expected:v.bigint,received:e.parsedType}),b}gte(e,t){return this.setLimit("min",e,!0,c.toString(t))}gt(e,t){return this.setLimit("min",e,!1,c.toString(t))}lte(e,t){return this.setLimit("max",e,!0,c.toString(t))}lt(e,t){return this.setLimit("max",e,!1,c.toString(t))}setLimit(e,t,r,n){return new _t({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:c.toString(n)}]})}_addCheck(e){return new _t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:c.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:c.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:c.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:c.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:c.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}).create=e=>{var t;return new _t({checks:[],typeName:O.ZodBigInt,coerce:null!=(t=null==e?void 0:e.coerce)&&t,...I(e)})},(xt=class extends f{_parse(e){var t;return this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==v.boolean?(R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.boolean,received:t.parsedType}),b):p(e.data)}}).create=e=>new xt({typeName:O.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...I(e)}),(wt=class extends f{_parse(e){var t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==v.date)return R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.date,received:t.parsedType}),b;if(isNaN(e.data.getTime()))return R(this._getOrReturnCtx(e),{code:y.invalid_date}),b;var r=new g;let n=void 0;for(const a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(R(n=this._getOrReturnCtx(e,n),{code:y.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(R(n=this._getOrReturnCtx(e,n),{code:y.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):l.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new wt({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:c.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:c.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}).create=e=>new wt({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:O.ZodDate,...I(e)}),(kt=class extends f{_parse(e){var t;return this._getType(e)!==v.symbol?(R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.symbol,received:t.parsedType}),b):p(e.data)}}).create=e=>new kt({typeName:O.ZodSymbol,...I(e)}),(St=class extends f{_parse(e){var t;return this._getType(e)!==v.undefined?(R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.undefined,received:t.parsedType}),b):p(e.data)}}).create=e=>new St({typeName:O.ZodUndefined,...I(e)}),(Tt=class extends f{_parse(e){var t;return this._getType(e)!==v.null?(R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.null,received:t.parsedType}),b):p(e.data)}}).create=e=>new Tt({typeName:O.ZodNull,...I(e)}),(Bt=class extends f{constructor(){super(...arguments),this._any=!0}_parse(e){return p(e.data)}}).create=e=>new Bt({typeName:O.ZodAny,...I(e)}),(Ct=class extends f{constructor(){super(...arguments),this._unknown=!0}_parse(e){return p(e.data)}}).create=e=>new Ct({typeName:O.ZodUnknown,...I(e)}),(x=class extends f{_parse(e){e=this._getOrReturnCtx(e);return R(e,{code:y.invalid_type,expected:v.never,received:e.parsedType}),b}}).create=e=>new x({typeName:O.ZodNever,...I(e)}),(Ot=class extends f{_parse(e){var t;return this._getType(e)!==v.undefined?(R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.void,received:t.parsedType}),b):p(e.data)}}).create=e=>new Ot({typeName:O.ZodVoid,...I(e)}),(w=class extends f{_parse(e){const{ctx:r,status:t}=this._processInputParams(e),n=this._def;var a;return r.parsedType!==v.array?(R(r,{code:y.invalid_type,expected:v.array,received:r.parsedType}),b):(null!==n.exactLength&&(e=r.data.length>n.exactLength.value,a=r.data.length<n.exactLength.value,e||a)&&(R(r,{code:e?y.too_big:y.too_small,minimum:a?n.exactLength.value:void 0,maximum:e?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),t.dirty()),null!==n.minLength&&r.data.length<n.minLength.value&&(R(r,{code:y.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),t.dirty()),null!==n.maxLength&&r.data.length>n.maxLength.value&&(R(r,{code:y.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),t.dirty()),r.common.async?Promise.all([...r.data].map((e,t)=>n.type._parseAsync(new _(r,e,r.path,t)))).then(e=>g.mergeArray(t,e)):(a=[...r.data].map((e,t)=>n.type._parseSync(new _(r,e,r.path,t))),g.mergeArray(t,a)))}get element(){return this._def.type}min(e,t){return new w({...this._def,minLength:{value:e,message:c.toString(t)}})}max(e,t){return new w({...this._def,maxLength:{value:e,message:c.toString(t)}})}length(e,t){return new w({...this._def,exactLength:{value:e,message:c.toString(t)}})}nonempty(e){return this.min(1,e)}}).create=(e,t)=>new w({type:e,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...I(t)}),(k=class extends f{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){var e,t;return null!==this._cached?this._cached:(e=this._def.shape(),t=l.objectKeys(e),this._cached={shape:e,keys:t})}_parse(e){if(this._getType(e)!==v.object)return R(u=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.object,received:u.parsedType}),b;const{status:t,ctx:r}=this._processInputParams(e);var{shape:n,keys:a}=this._getCached(),s=[];if(!(this._def.catchall instanceof x&&"strip"===this._def.unknownKeys))for(const h in r.data)a.includes(h)||s.push(h);const i=[];for(const p of a){var o=n[p],c=r.data[p];i.push({key:{status:"valid",value:p},value:o._parse(new _(r,c,r.path,p)),alwaysSet:p in r.data})}if(this._def.catchall instanceof x){var u=this._def.unknownKeys;if("passthrough"===u)for(const f of s)i.push({key:{status:"valid",value:f},value:{status:"valid",value:r.data[f]}});else if("strict"===u)0<s.length&&(R(r,{code:y.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==u)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{var d=this._def.catchall;for(const m of s){var l=r.data[m];i.push({key:{status:"valid",value:m},value:d._parse(new _(r,l,r.path,m)),alwaysSet:m in r.data})}}return r.common.async?Promise.resolve().then(async()=>{var e=[];for(const n of i){var t=await n.key,r=await n.value;e.push({key:t,value:r,alwaysSet:n.alwaysSet})}return e}).then(e=>g.mergeObjectSync(t,e)):g.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(a){return c.errToObj,new k({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(e,t)=>{var r,n=null!=(r=null==(r=(n=this._def).errorMap)?void 0:r.call(n,e,t).message)?r:t.defaultError;return"unrecognized_keys"===e.code?{message:null!=(r=c.errToObj(a).message)?r:n}:{message:n}}}:{}})}strip(){return new k({...this._def,unknownKeys:"strip"})}passthrough(){return new k({...this._def,unknownKeys:"passthrough"})}extend(e){return new k({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new k({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new k({...this._def,catchall:e})}pick(t){const r={};return l.objectKeys(t).forEach(e=>{t[e]&&this.shape[e]&&(r[e]=this.shape[e])}),new k({...this._def,shape:()=>r})}omit(t){const r={};return l.objectKeys(this.shape).forEach(e=>{t[e]||(r[e]=this.shape[e])}),new k({...this._def,shape:()=>r})}deepPartial(){return Tn(this)}partial(r){const n={};return l.objectKeys(this.shape).forEach(e=>{var t=this.shape[e];r&&!r[e]?n[e]=t:n[e]=t.optional()}),new k({...this._def,shape:()=>n})}required(e){const r={};return l.objectKeys(this.shape).forEach(t=>{if(e&&!e[t])r[t]=this.shape[t];else{let e=this.shape[t];for(;e instanceof C;)e=e._def.innerType;r[t]=e}}),new k({...this._def,shape:()=>r})}keyof(){return Cn(l.objectKeys(this.shape))}}).create=(e,t)=>new k({shape:()=>e,unknownKeys:"strip",catchall:x.create(),typeName:O.ZodObject,...I(t)}),k.strictCreate=(e,t)=>new k({shape:()=>e,unknownKeys:"strict",catchall:x.create(),typeName:O.ZodObject,...I(t)}),k.lazycreate=(e,t)=>new k({shape:e,unknownKeys:"strip",catchall:x.create(),typeName:O.ZodObject,...I(t)}),(Et=class extends f{_parse(t){const n=this._processInputParams(t)["ctx"];t=this._def.options;if(n.common.async)return Promise.all(t.map(async e=>{var t={...n,common:{...n.common,issues:[]},parent:null};return{result:await e._parseAsync({data:n.data,path:n.path,parent:t}),ctx:t}})).then(function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const r of e)if("dirty"===r.result.status)return n.common.issues.push(...r.ctx.common.issues),r.result;return e=e.map(e=>new u(e.ctx.common.issues)),R(n,{code:y.invalid_union,unionErrors:e}),b});{let e=void 0;var r=[];for(const i of t){var a={...n,common:{...n.common,issues:[]},parent:null},s=i._parseSync({data:n.data,path:n.path,parent:a});if("valid"===s.status)return s;"dirty"===s.status&&(e=e||{result:s,ctx:a}),a.common.issues.length&&r.push(a.common.issues)}return e?(n.common.issues.push(...e.ctx.common.issues),e.result):(t=r.map(e=>new u(e)),R(n,{code:y.invalid_union,unionErrors:t}),b)}}get options(){return this._def.options}}).create=(e,t)=>new Et({options:e,typeName:O.ZodUnion,...I(t)}),S=e=>e instanceof At?S(e.schema):e instanceof B?S(e.innerType()):e instanceof Dt?[e.value]:e instanceof Lt?e.options:e instanceof $t?l.objectValues(e.enum):e instanceof Vt?S(e._def.innerType):e instanceof St?[void 0]:e instanceof Tt?[null]:e instanceof C?[void 0,...S(e.unwrap())]:e instanceof Ut?[null,...S(e.unwrap())]:e instanceof Wt||e instanceof Ht?S(e.unwrap()):e instanceof qt?S(e._def.innerType):[],Zt=class extends f{_parse(e){var t,r,e=this._processInputParams(e)["ctx"];return e.parsedType!==v.object?(R(e,{code:y.invalid_type,expected:v.object,received:e.parsedType}),b):(t=this.discriminator,r=e.data[t],(r=this.optionsMap.get(r))?e.common.async?r._parseAsync({data:e.data,path:e.path,parent:e}):r._parseSync({data:e.data,path:e.path,parent:e}):(R(e,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[t]}),b))}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){var n=new Map;for(const s of t){var a=S(s.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const i of a){if(n.has(i))throw new Error(`Discriminator property ${String(e)} has duplicate value `+String(i));n.set(i,s)}}return new Zt({typeName:O.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...I(r)})}},(Pt=class extends f{_parse(e){const{status:n,ctx:a}=this._processInputParams(e),r=(e,t)=>{var r;return Ge(e)||Ge(t)?b:(r=Bn(e.value,t.value)).valid?((Qe(e)||Qe(t))&&n.dirty(),{status:n.value,value:r.data}):(R(a,{code:y.invalid_intersection_types}),b)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([e,t])=>r(e,t)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}).create=(e,t,r)=>new Pt({left:e,right:t,typeName:O.ZodIntersection,...I(r)}),(T=class extends f{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);return n.parsedType!==v.array?(R(n,{code:y.invalid_type,expected:v.array,received:n.parsedType}),b):n.data.length<this._def.items.length?(R(n,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b):(!this._def.rest&&n.data.length>this._def.items.length&&(R(n,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty()),e=[...n.data].map((e,t)=>{var r=this._def.items[t]||this._def.rest;return r?r._parse(new _(n,e,n.path,t)):null}).filter(e=>!!e),n.common.async?Promise.all(e).then(e=>g.mergeArray(t,e)):g.mergeArray(t,e))}get items(){return this._def.items}rest(e){return new T({...this._def,rest:e})}}).create=(e,t)=>{if(Array.isArray(e))return new T({items:e,typeName:O.ZodTuple,rest:null,...I(t)});throw new Error("You must pass an array of schemas to z.tuple([ ... ])")},Nt=class extends f{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){var{status:e,ctx:t}=this._processInputParams(e);if(t.parsedType!==v.object)return R(t,{code:y.invalid_type,expected:v.object,received:t.parsedType}),b;var r=[],n=this._def.keyType,a=this._def.valueType;for(const s in t.data)r.push({key:n._parse(new _(t,s,t.path,s)),value:a._parse(new _(t,t.data[s],t.path,s)),alwaysSet:s in t.data});return t.common.async?g.mergeObjectAsync(e,r):g.mergeObjectSync(e,r)}get element(){return this._def.valueType}static create(e,t,r){return new Nt(t instanceof f?{keyType:e,valueType:t,typeName:O.ZodRecord,...I(r)}:{keyType:m.create(),valueType:e,typeName:O.ZodRecord,...I(t)})}},(jt=class extends f{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:a}=this._processInputParams(e);if(a.parsedType!==v.map)return R(a,{code:y.invalid_type,expected:v.map,received:a.parsedType}),b;const s=this._def.keyType,i=this._def.valueType,o=[...a.data.entries()].map(([e,t],r)=>({key:s._parse(new _(a,e,a.path,[r,"key"])),value:i._parse(new _(a,t,a.path,[r,"value"]))}));if(a.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const r of o){var e=await r.key,t=await r.value;if("aborted"===e.status||"aborted"===t.status)return b;"dirty"!==e.status&&"dirty"!==t.status||n.dirty(),u.set(e.value,t.value)}return{status:n.value,value:u}})}var t=new Map;for(const d of o){var r=d.key,c=d.value;if("aborted"===r.status||"aborted"===c.status)return b;"dirty"!==r.status&&"dirty"!==c.status||n.dirty(),t.set(r.value,c.value)}return{status:n.value,value:t}}}).create=(e,t,r)=>new jt({valueType:t,keyType:e,typeName:O.ZodMap,...I(r)}),(Rt=class extends f{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==v.set)return R(r,{code:y.invalid_type,expected:v.set,received:r.parsedType}),b;e=this._def;null!==e.minSize&&r.data.size<e.minSize.value&&(R(r,{code:y.too_small,minimum:e.minSize.value,type:"set",inclusive:!0,exact:!1,message:e.minSize.message}),n.dirty()),null!==e.maxSize&&r.data.size>e.maxSize.value&&(R(r,{code:y.too_big,maximum:e.maxSize.value,type:"set",inclusive:!0,exact:!1,message:e.maxSize.message}),n.dirty());const a=this._def.valueType;function t(e){var t=new Set;for(const r of e){if("aborted"===r.status)return b;"dirty"===r.status&&n.dirty(),t.add(r.value)}return{status:n.value,value:t}}e=[...r.data.values()].map((e,t)=>a._parse(new _(r,e,r.path,t)));return r.common.async?Promise.all(e).then(e=>t(e)):t(e)}min(e,t){return new Rt({...this._def,minSize:{value:e,message:c.toString(t)}})}max(e,t){return new Rt({...this._def,maxSize:{value:e,message:c.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}).create=(e,t)=>new Rt({valueType:e,minSize:null,maxSize:null,typeName:O.ZodSet,...I(t)}),It=class extends f{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const r=this._processInputParams(e)["ctx"];if(r.parsedType!==v.function)return R(r,{code:y.invalid_type,expected:v.function,received:r.parsedType}),b;function a(e,t){return He({data:e,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,mn(),We].filter(e=>!!e),issueData:{code:y.invalid_arguments,argumentsError:t}})}function s(e,t){return He({data:e,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,mn(),We].filter(e=>!!e),issueData:{code:y.invalid_return_type,returnTypeError:t}})}const i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof zt){const c=this;return p(async function(...t){const r=new u([]);var e=await c._def.args.parseAsync(t,i).catch(e=>{throw r.addIssue(a(t,e)),r});const n=await Reflect.apply(o,this,e);return await c._def.returns._def.type.parseAsync(n,i).catch(e=>{throw r.addIssue(s(n,e)),r})})}{const n=this;return p(function(...e){var t=n._def.args.safeParse(e,i);if(!t.success)throw new u([a(e,t.error)]);e=Reflect.apply(o,this,t.data),t=n._def.returns.safeParse(e,i);if(t.success)return t.data;throw new u([s(e,t.error)])})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new It({...this._def,args:T.create(e).rest(Ct.create())})}returns(e){return new It({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new It({args:e||T.create([]).rest(Ct.create()),returns:t||Ct.create(),typeName:O.ZodFunction,...I(r)})}},(At=class extends f{get schema(){return this._def.getter()}_parse(e){e=this._processInputParams(e).ctx;return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}}).create=(e,t)=>new At({getter:e,typeName:O.ZodLazy,...I(t)}),(Dt=class extends f{_parse(e){var t;return e.data!==this._def.value?(R(t=this._getOrReturnCtx(e),{received:t.data,code:y.invalid_literal,expected:this._def.value}),b):{status:"valid",value:e.data}}get value(){return this._def.value}}).create=(e,t)=>new Dt({value:e,typeName:O.ZodLiteral,...I(t)}),Lt=class extends f{constructor(){super(...arguments),Mt.set(this,void 0)}_parse(e){var t,r;return"string"!=typeof e.data?(r=this._getOrReturnCtx(e),t=this._def.values,R(r,{expected:l.joinValues(t),received:r.parsedType,code:y.invalid_type}),b):(vn(this,Mt,"f")||yn(this,Mt,new Set(this._def.values),"f"),vn(this,Mt,"f").has(e.data)?p(e.data):(t=this._getOrReturnCtx(e),r=this._def.values,R(t,{received:t.data,code:y.invalid_enum_value,options:r}),b))}get options(){return this._def.values}get enum(){var e={};for(const t of this._def.values)e[t]=t;return e}get Values(){var e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){var e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Lt.create(e,{...this._def,...t})}exclude(t,e=this._def){return Lt.create(this.options.filter(e=>!t.includes(e)),{...this._def,...e})}},Mt=new WeakMap,Lt.create=Cn,$t=class extends f{constructor(){super(...arguments),Ft.set(this,void 0)}_parse(e){var t,r=l.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);return n.parsedType!==v.string&&n.parsedType!==v.number?(t=l.objectValues(r),R(n,{expected:l.joinValues(t),received:n.parsedType,code:y.invalid_type}),b):(vn(this,Ft,"f")||yn(this,Ft,new Set(l.getValidEnumValues(this._def.values)),"f"),vn(this,Ft,"f").has(e.data)?p(e.data):(t=l.objectValues(r),R(n,{received:n.data,code:y.invalid_enum_value,options:t}),b))}get enum(){return this._def.values}},Ft=new WeakMap,$t.create=(e,t)=>new $t({values:e,typeName:O.ZodNativeEnum,...I(t)}),(zt=class extends f{unwrap(){return this._def.type}_parse(e){const t=this._processInputParams(e)["ctx"];return t.parsedType!==v.promise&&!1===t.common.async?(R(t,{code:y.invalid_type,expected:v.promise,received:t.parsedType}),b):(e=t.parsedType===v.promise?t.data:Promise.resolve(t.data),p(e.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}).create=(e,t)=>new zt({type:e,typeName:O.ZodPromise,...I(t)}),(B=class extends f{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),n=this._def.effect||null,a={addIssue:e=>{R(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),"preprocess"===n.type)return e=n.transform(r.data,a),r.common.async?Promise.resolve(e).then(async e=>{return"aborted"===t.value||"aborted"===(e=await this._def.schema._parseAsync({data:e,path:r.path,parent:r})).status?b:"dirty"===e.status||"dirty"===t.value?Ye(e.value):e}):"aborted"===t.value||"aborted"===(e=this._def.schema._parseSync({data:e,path:r.path,parent:r})).status?b:"dirty"===e.status||"dirty"===t.value?Ye(e.value):e;if("refinement"===n.type){const s=e=>{var t=n.refinement(e,a);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};return!1===r.common.async?"aborted"===(e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r})).status?b:("dirty"===e.status&&t.dirty(),s(e.value),{status:t.value,value:e.value}):this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>"aborted"===e.status?b:("dirty"===e.status&&t.dirty(),s(e.value).then(()=>({status:t.value,value:e.value}))))}if("transform"===n.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>Xe(e)?Promise.resolve(n.transform(e.value,a)).then(e=>({status:t.value,value:e})):e);e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Xe(e))return e;e=n.transform(e.value,a);if(e instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:e}}l.assertNever(n)}}).create=(e,t,r)=>new B({schema:e,typeName:O.ZodEffects,effect:t,...I(r)}),B.createWithPreprocess=(e,t,r)=>new B({schema:t,effect:{type:"preprocess",transform:e},typeName:O.ZodEffects,...I(r)}),(C=class extends f{_parse(e){return this._getType(e)===v.undefined?p(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}).create=(e,t)=>new C({innerType:e,typeName:O.ZodOptional,...I(t)}),(Ut=class extends f{_parse(e){return this._getType(e)===v.null?p(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}).create=(e,t)=>new Ut({innerType:e,typeName:O.ZodNullable,...I(t)}),(Vt=class extends f{_parse(e){e=this._processInputParams(e).ctx;let t=e.data;return e.parsedType===v.undefined&&(t=this._def.defaultValue()),this._def.innerType._parse({data:t,path:e.path,parent:e})}removeDefault(){return this._def.innerType}}).create=(e,t)=>new Vt({innerType:e,typeName:O.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...I(t)}),(qt=class extends f{_parse(e){e=this._processInputParams(e).ctx;const t={...e,common:{...e.common,issues:[]}};e=this._def.innerType._parse({data:t.data,path:t.path,parent:{...t}});return et(e)?e.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new u(t.common.issues)},input:t.data})})):{status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new u(t.common.issues)},input:t.data})}}removeCatch(){return this._def.innerType}}).create=(e,t)=>new qt({innerType:e,typeName:O.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...I(t)}),(Kt=class extends f{_parse(e){var t;return this._getType(e)!==v.nan?(R(t=this._getOrReturnCtx(e),{code:y.invalid_type,expected:v.nan,received:t.parsedType}),b):{status:"valid",value:e.data}}}).create=e=>new Kt({typeName:O.ZodNaN,...I(e)}),e=Symbol("zod_brand"),Wt=class extends f{_parse(e){var e=this._processInputParams(e)["ctx"],t=e.data;return this._def.type._parse({data:t,path:e.path,parent:e})}unwrap(){return this._def.type}},Jt=class extends f{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);return r.common.async?(async()=>{var e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?b:"dirty"===e.status?(t.dirty(),Ye(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})():"aborted"===(e=this._def.in._parseSync({data:r.data,path:r.path,parent:r})).status?b:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}static create(e,t){return new Jt({in:e,out:t,typeName:O.ZodPipeline})}},(Ht=class extends f{_parse(e){e=this._def.innerType._parse(e);const t=e=>(Xe(e)&&(e.value=Object.freeze(e.value)),e);return et(e)?e.then(e=>t(e)):t(e)}unwrap(){return this._def.innerType}}).create=(e,t)=>new Ht({innerType:e,typeName:O.ZodReadonly,...I(t)}),V={object:k.lazycreate},(r=O=O||{}).ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly",Yt=m.create,Gt=bt.create,r=_t.create,Qt=xt.create,Xt=wt.create,er=w.create,tr=k.create,rr=k.strictCreate,nr=Et.create,ar=Zt.create,sr=Pt.create,ir=T.create,or=Nt.create,cr=Rt.create,ur=It.create,dr=At.create,lr=Dt.create,hr=Lt.create,pr=$t.create,fr=zt.create,mr=B.create,vr=C.create,yr=Ut.create,gr=B.createWithPreprocess,br=Jt.create,_r=(e=Object.freeze({__proto__:null,defaultErrorMap:We,setErrorMap:function(e){Je=e},getErrorMap:mn,makeIssue:He,EMPTY_PATH:[],addIssueToContext:R,ParseStatus:g,INVALID:b,DIRTY:Ye,OK:p,isAborted:Ge,isDirty:Qe,isValid:Xe,isAsync:et,get util(){return l},get objectUtil(){return Le},ZodParsedType:v,getParsedType:h,ZodType:f,datetimeRegex:_n,ZodString:m,ZodNumber:bt,ZodBigInt:_t,ZodBoolean:xt,ZodDate:wt,ZodSymbol:kt,ZodUndefined:St,ZodNull:Tt,ZodAny:Bt,ZodUnknown:Ct,ZodNever:x,ZodVoid:Ot,ZodArray:w,ZodObject:k,ZodUnion:Et,ZodDiscriminatedUnion:Zt,ZodIntersection:Pt,ZodTuple:T,ZodRecord:Nt,ZodMap:jt,ZodSet:Rt,ZodFunction:It,ZodLazy:At,ZodLiteral:Dt,ZodEnum:Lt,ZodNativeEnum:$t,ZodPromise:zt,ZodEffects:B,ZodTransformer:B,ZodOptional:C,ZodNullable:Ut,ZodDefault:Vt,ZodCatch:qt,ZodNaN:Kt,BRAND:e,ZodBranded:Wt,ZodPipeline:Jt,ZodReadonly:Ht,custom:On,Schema:f,ZodSchema:f,late:V,get ZodFirstPartyTypeKind(){return O},coerce:{string:e=>m.create({...e,coerce:!0}),number:e=>bt.create({...e,coerce:!0}),boolean:e=>xt.create({...e,coerce:!0}),bigint:e=>_t.create({...e,coerce:!0}),date:e=>wt.create({...e,coerce:!0})},any:Bt.create,array:er,bigint:r,boolean:Qt,date:Xt,discriminatedUnion:ar,effect:mr,enum:hr,function:ur,instanceof:(t,e={message:"Input not instance of "+t.name})=>On(e=>e instanceof t,e),intersection:sr,lazy:dr,literal:lr,map:jt.create,nan:Kt.create,nativeEnum:pr,never:x.create,null:Tt.create,nullable:yr,number:Gt,object:tr,oboolean:()=>Qt().optional(),onumber:()=>Gt().optional(),optional:vr,ostring:()=>Yt().optional(),pipeline:br,preprocess:gr,promise:fr,record:or,set:cr,strictObject:rr,string:Yt,symbol:kt.create,transformer:mr,tuple:ir,undefined:St.create,union:nr,unknown:Ct.create,void:Ot.create,NEVER:b,ZodIssueCode:y,quotelessJson:e=>{return JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:")},ZodError:u})).object({uri:e.string().nonempty({message:"Track URI is required"}).refine(e=>Spicetify.URI.isTrack(e),{message:"Invalid track URI"})}).strict().readonly(),xr=class{constructor(e,t){this.songState=e,this.settings=t}playerSubscription=new s;currentBeat=null;bouncing=!1;bounceSeed=null;bounceCount=0;lastBranch=null;isSeekingResolver=null;beatsSinceLastBranch=0;onProgressSubject=new ke;onProgress$=this.onProgressSubject.asObservable();start(){this.logDebug("Driver started."),document.addEventListener("keydown",this.onBounceKeyDown),document.addEventListener("keyup",this.onBounceKeyUp);var e=un(Spicetify.Player,"onprogress").pipe(sn(e=>e.data),ln()).subscribe(e=>{this.process(e)});this.playerSubscription.add(e)}onBounceKeyDown=e=>{"Shift"===e.key&&(this.bouncing=!0)};onBounceKeyUp=e=>{"Shift"===e.key&&(this.bouncing=!1)};async process(e){if(null!==this.isSeekingResolver){if(this.logDebug(`Is seeking... ${e} -> `+this.currentBeat?.start),!this.isSeekingResolver(e))return;this.isSeekingResolver=null}if(this.logDebug(`Processing with current beat: ${this.currentBeat?.toString()}, player time: `+Spicetify.Player.getProgress()),null!==this.lastBranch&&this.setLastBranchPlaying(!1),null!==this.currentBeat){if(this.currentBeat.isInBeat(e))return;this.currentBeat.isPlaying=!1}this.beatsSinceLastBranch++;var t=this.currentBeat?.next?.end,r=this.currentBeat?.previous?.start,t=null!=t&&t<e||null!=r&&e<r,r=(t&&console.error(`Out of sync ! ${e} - `+this.currentBeat?.toString()),this.currentBeat);this.currentBeat=this.getNextBeat(e,t),null!==this.currentBeat&&(this.logDebug(`Got next beat: ${this.currentBeat?.index}, with time: ${this.currentBeat?.start} - ${this.currentBeat?.end}, player time: `+Spicetify.Player.getProgress()),await this.playBeat(r,this.currentBeat,e,t),this.currentBeat.playCount+=1,this.songState.beatsPlayed+=1,null!==r&&(r.isPlaying=!1),this.currentBeat.isPlaying=!0,this.onProgressSubject.next())}async playBeat(e,t,r,n){if(null!==e&&e.index+1!==t.index&&!n){n=Spicetify.Player.getProgress()-e.end;const a=t.start+n;this.logDebug(`Seek to: ${a}ms, from ${r}ms, with offset `+n);e=a>Spicetify.Player.getProgress();this.isSeekingResolver=e?e=>e>=a:e=>e<=a+1e3,this.logDebug(`Time to get there: ${Math.abs(Spicetify.Player.getProgress()-r)}ms`),await Br().PlayerAPI.seekTo(a)}}getNextBeat(e,t){if(null===this.currentBeat||t){for(const r of this.songState.graph.beats)if(e>=r.start&&e<=r.end)return r;return this.songState.graph.beats[0]}return this.bouncing?(null===this.bounceSeed&&(this.bounceSeed=this.currentBeat,this.bounceCount=0),this.bounceCount++%2==1?this.selectNextNeighbor(this.bounceSeed):this.bounceSeed):null!=this.bounceSeed?(t=this.bounceSeed,this.bounceSeed=null,t):(t=this.currentBeat.index+1)>=this.songState.graph.beats.length?(this.stop(),null):this.selectRandomNextBeat(this.songState.graph.beats[t])}selectRandomNextBeat(e){var t;return 0!==e.neighbours.length&&this.shouldRandomBranch(e)?(t=e.neighbours.shift(),e.neighbours.push(t),this.beatsSinceLastBranch=0,this.lastBranch=t,this.setLastBranchPlaying(!0),t.destination):e}setLastBranchPlaying(e){null!==this.lastBranch&&(this.lastBranch.isPlaying=e,this.lastBranch.source.isPlaying=e,this.lastBranch.destination.isPlaying=e)}selectNextNeighbor(e){var t;return 0===e.neighbours.length?e:(t=e.neighbours.shift(),e.neighbours.push(t),this.lastBranch=t,this.setLastBranchPlaying(!0),t.destination)}shouldRandomBranch(e){var t=(new Date).getTime()-this.songState.startTime;if(0<this.settings.maxJukeboxPlayTime&&t>this.settings.maxJukeboxPlayTime)return this.songState.currentRandomBranchChance=0,!1;if(e.index===this.songState.graph.lastBranchPoint&&this.settings.alwaysFollowLastBranch&&t<=this.settings.maxJukeboxPlayTime)return!0;if(this.beatsSinceLastBranch<=d.minBeatsBeforeBranching)return!1;this.songState.currentRandomBranchChance=Math.min(this.songState.currentRandomBranchChance+this.settings.randomBranchChanceDelta,this.settings.maxRandomBranchChance);e=Math.random()<this.songState.currentRandomBranchChance;return e&&(this.songState.currentRandomBranchChance=this.settings.minRandomBranchChance),e}stop(){this.playerSubscription.unsubscribe(),this.playerSubscription=new s,document.removeEventListener("keydown",this.onBounceKeyDown),document.removeEventListener("keyup",this.onBounceKeyUp)}logDebug(e){}},t(kr=wr=class{static get settings(){return d.fromPartial(wr.storedSettings)}static set settings(e){wr.storedSettings=e.toPartial()}static get storedSettings(){var e=Spicetify.LocalStorage.get(this.settingId);return null==e?(new d).toPartial():JSON.parse(e)}static set storedSettings(e){Spicetify.LocalStorage.set(this.settingId,JSON.stringify(e))}},"settingId","jukebox:settings"),Sr=class{_songState=null;songStateSubject=new Ce(null);songState$=this.songStateSubject.asObservable();get songState(){return this._songState}set songState(e){this._songState=e,this.songStateSubject.next(e)}settings;driver=null;get isEnabled(){return this.stateChangedSubject.value}async setEnabled(e){e?await this.enable():this.disable()}songChangedSubscription=new s;driverProcessSubscription=new s;statsChangedSubject=new ke;statsChanged$=this.statsChangedSubject.asObservable();stateChangedSubject=new Ce(!1);stateChanged$=this.stateChangedSubject.asObservable();constructor(){this.settings=kr.settings}async reloadSettings(){this.settings=kr.settings,this.isEnabled&&(this.stop(),await this.start())}async enable(){this.stateChangedSubject.next(!0);var e=un(Spicetify.Player,"songchange").subscribe(()=>{this.stop(),this.start()});this.songChangedSubscription.add(e),await this.start()}disable(){this.stop(),this.songChangedSubscription.unsubscribe(),this.songChangedSubscription=new s,this.stateChangedSubject.next(!1)}stop(){this.driver?.stop(),this.driver=null,this.driverProcessSubscription.unsubscribe(),this.driverProcessSubscription=new s,this.songState=null}async start(){var t=Spicetify.Player.data.item;if(void 0!==t){Spicetify.showNotification("Fetching analysis for song...");var r,n=t.uri;if(Spicetify.URI.isLocalTrack(n))this.disableWithError("No analysis available for local tracks.");else if(Spicetify.URI.isEpisode(n))this.disableWithError("No analysis available for shows.");else{let e=null;try{e=await En({uri:n})}catch{}null===e||0===e.beats.length?this.disableWithError("No analysis available for this track."):(n=new Ve(e).remixTrack(),r=new Ue(this.settings,n.beats).generateGraph(),this.songState=new qe(t,n,r),this.driver=new xr(this.songState,this.settings),this.driverProcessSubscription.add(this.driver.onProgress$.subscribe(()=>{this.statsChangedSubject.next({beatsPlayed:this.songState?.beatsPlayed??0,currentRandomBranchChance:this.songState?.currentRandomBranchChance??0,listenTime:null!==this.songState?(new Date).getTime()-this.songState.startTime:0})})),this.driver.start())}}}disableWithError(e){Spicetify.showNotification(e,!0),this.disable()}},(async()=>{await new Promise(e=>{Spicetify.Events.platformLoaded.on(()=>{e()})}),window.jukebox=new Sr;let e=null;try{e=await Tr(".player-controls__right")}catch{}if(null===e)try{var t=await Tr(".main-repeatButton-button");e=t.parentElement}catch{}try{if(null===e)throw new Error("Container element not found");var r=document.createElement("style");r.innerText=`
        button.jukebox-toggle {
            border-color: var(--text-base);
        }

        button.jukebox-toggle.active {
            color: var(--spice-button-active);
        }

        button.jukebox-toggle:focus-visible {
            border-width: 2px;
            border-style: solid;
        }

        button.jukebox-toggle:focus::after {
            border-color: transparent !important;
        }

        button.jukebox-toggle.active:before {
            background-color: currentcolor;
            border-radius: 50%;
            bottom: 0;
            content: "";
            display: block;
            left: 50%;
            position: absolute;
            width: 4px;
            inline-size: 4px;
            height: 4px;
            -webkit-transform: translateX(-50%);
            transform: translateX(-50%);
        }
    `,document.head.appendChild(r),n=re.default.createElement(fn,{className:"jukebox-toggle"}),a=e,s=Spicetify.ReactDOM.createRoot(document.createElement("div")),n=Spicetify.ReactDOM.createPortal(n,a),s.render(n),async function(e,r){var n=Br().History;const a=async()=>{await Cr(e,r)||Spicetify.showNotification(" A new version of the custom app is available.",!1,5e3)};if(n.location.pathname==="/"+r)await a();else{let t=null;t=n.listen(async e=>{e.pathname==="/"+r&&(await a(),t?.())})}}("1.0.0-beta.5","eternal-jukebox")}catch(e){console.error(e),Spicetify.showNotification("Failed to register the eternal jukebox playbar button",!0)}var n,a,s})();async function Tr(a,s=5e3,i=null,o=!1){return new Promise((e,t)=>{let r=document.querySelector(a);if(null!==r)o&&console.log("found element in querySelector"),e(r);else{const n=new MutationObserver(()=>{null!==(r=document.querySelector(a))&&(o&&console.log("found element in observer"),e(r),n.disconnect())});null===i&&(i=document.body),n.observe(i,{childList:!0,subtree:!0}),setTimeout(()=>{null===r&&(o&&console.log("trying to find element from querySelector again"),n.disconnect(),null!==(r=document.querySelector(a))?e(r):t(new Error(`Couldn't find the element "${a}".`)))},s)}})}function Br(){return Spicetify.Platform}async function Cr(e,t){t=await(await(await fetch(`https://raw.githubusercontent.com/Pithaya/spicetify-apps/main/custom-apps/${t}/package.json`)).json()).version;return G(e,t,">=")}function Or(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ie(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Er(e,i,o,c){return new(o=o||Promise)(function(r,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function a(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?r(e.value):((t=e.value)instanceof o?t:new o(function(e){e(t)})).then(n,a)}s((c=c.apply(e,i||[])).next())})}function Zr(n,a){var s,i,o,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function e(r){return function(e){var t=[r,e];if(s)throw new TypeError("Generator is already executing.");for(;c=u&&t[u=0]?0:c;)try{if(s=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,i=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(o=0<(o=c.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3]))c.label=t[1];else if(6===t[0]&&c.label<o[1])c.label=o[1],o=t;else{if(!(o&&c.label<o[2])){o[2]&&c.ops.pop(),c.trys.pop();continue}c.label=o[2],c.ops.push(t)}}t=a.call(n,c)}catch(e){t=[6,e],i=0}finally{s=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function Pr(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nr(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,s=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(n=s.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(a)throw a.error}}return i}function jr(e,t,r){if(r||2===arguments.length)for(var n,a=0,s=t.length;a<s;a++)!n&&a in t||((n=n||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function Rr(e){return this instanceof Rr?(this.v=e,this):new Rr(e)}function Ir(e,t,r){var a,s,i;if(Symbol.asyncIterator)return a=r.apply(e,t||[]),s=[],i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i;throw new TypeError("Symbol.asyncIterator is not defined.");function n(n){a[n]&&(i[n]=function(r){return new Promise(function(e,t){1<s.push([n,r,e,t])||o(n,r)})})}function o(e,t){try{(r=a[e](t)).value instanceof Rr?Promise.resolve(r.value.v).then(c,u):d(s[0][2],r)}catch(e){d(s[0][3],e)}var r}function c(e){o("next",e)}function u(e){o("throw",e)}function d(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function Ar(i){var e,t;if(Symbol.asyncIterator)return(e=i[Symbol.asyncIterator])?e.call(i):(i=Pr(i),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);throw new TypeError("Symbol.asyncIterator is not defined.");function r(s){t[s]=i[s]&&function(a){return new Promise(function(e,t){var r,n;a=i[s](a),r=e,e=t,n=a.done,t=a.value,Promise.resolve(t).then(function(e){r({value:e,done:n})},e)})}}}function E(e){return"function"==typeof e}function Dr(e){e=e(function(e){Error.call(e),e.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e}function Lr(e,t){e&&0<=(t=e.indexOf(t))&&e.splice(t,1)}function Z(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}function Mr(e){return e instanceof s||e&&"closed"in e&&E(e.remove)&&E(e.add)&&E(e.unsubscribe)}function $r(e){E(e)?e():e.unsubscribe()}function Fr(t){ue.setTimeout(function(){var e=a.onUnhandledError;if(!e)throw t;e(t)})}function zr(){}function Ur(e,t,r){return{kind:e,value:t,error:r}}function Vr(e){if(a.useDeprecatedSynchronousErrorHandling){var t=!n;if(t&&(n={errorThrown:!1,error:null}),e(),t){var t=n,r=t.errorThrown,t=t.error;if(n=null,r)throw t}}else e()}function P(e){var t=le.call(this)||this;return t.isStopped=!1,e?Mr(t.destination=e)&&e.add(t):t.destination=ye,t}function qr(e,t){return pe.call(e,t)}function Kr(e){this.partialObserver=e}function Wr(e,t,r){var n=me.call(this)||this;return r=E(e)||!e?{next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=r?r:void 0}:n&&a.useDeprecatedNextContext?((t=Object.create(e)).unsubscribe=function(){return n.unsubscribe()},{next:e.next&&qr(e.next,t),error:e.error&&qr(e.error,t),complete:e.complete&&qr(e.complete,t)}):e,n.destination=new fe(r),n}function Jr(e){var t;a.useDeprecatedSynchronousErrorHandling?(t=e,a.useDeprecatedSynchronousErrorHandling&&n&&(n.errorThrown=!0,n.error=t)):Fr(e)}function Hr(e,t){var r=a.onStoppedNotification;r&&ue.setTimeout(function(){return r(e,t)})}function Yr(e){return e}function N(e){e&&(this._subscribe=e)}function Gr(e){return null!=(e=null!=e?e:a.Promise)?e:Promise}function Qr(r){return function(e){if(E(null==(t=e)?void 0:t.lift))return e.lift(function(e){try{return r(e,this)}catch(e){this.error(e)}});var t;throw new TypeError("Unable to lift unknown Observable type")}}function Xr(e,t,r,n,a){return new _e(e,t,r,n,a)}function en(t,r,e,n,a,s){var i=be.call(this,t)||this;return i.onFinalize=a,i.shouldUnsubscribe=s,i._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:be.prototype._next,i._error=n?function(e){try{n(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:be.prototype._error,i._complete=e?function(){try{e()}catch(e){t.error(e)}finally{this.unsubscribe()}}:be.prototype._complete,i}function j(){var e=xe.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}function tn(e,t){var r=Se.call(this)||this;return r.destination=e,r.source=t,r}function rn(e){var t=Be.call(this)||this;return t._value=e,t}function nn(e){if(e instanceof o)return e;if(null!=e){if(E(e[ge]))return a=e,new o(function(e){var t=a[ge]();if(E(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")});if(Oe(e))return n=e,new o(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()});if(E(null==(t=e)?void 0:t.then))return r=e,new o(function(t){r.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,Fr)});if(t=e,Symbol.asyncIterator&&E(null==t?void 0:t[Symbol.asyncIterator]))return an(e);if(E(null==(t=e)?void 0:t[Ee]))return i=e,new o(function(e){var t,r;try{for(var n=Pr(i),a=n.next();!a.done;a=n.next()){var s=a.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}e.complete()});if(E(null==(t=e)?void 0:t.getReader))return an(function(a){return Ir(this,arguments,function(){var t,r,n;return Zr(this,function(e){switch(e.label){case 0:t=a.getReader(),e.label=1;case 1:e.trys.push([1,,9,10]),e.label=2;case 2:return[4,Rr(t.read())];case 3:return(r=e.sent(),n=r.value,r.done)?[4,Rr(void 0)]:[3,5];case 4:return[2,e.sent()];case 5:return[4,Rr(n)];case 6:return[4,e.sent()];case 7:return e.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}(e))}var i,r,n,a,t;throw t=e,new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function an(e){return new o(function(t){!function(r,n){var a,s,i,o;return Er(this,void 0,void 0,function(){var t;return Zr(this,function(e){switch(e.label){case 0:e.trys.push([0,5,6,11]),a=Ar(r),e.label=1;case 1:return[4,a.next()];case 2:if((s=e.sent()).done)return[3,4];if(t=s.value,n.next(t),n.closed)return[2];e.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return t=e.sent(),i={error:t},[3,11];case 6:return(e.trys.push([6,,9,10]),s&&!s.done&&(o=a.return))?[4,o.call(a)]:[3,8];case 7:e.sent(),e.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}(e,t).catch(function(e){return t.error(e)})})}function sn(n,a){return Qr(function(e,t){var r=0;e.subscribe(Xr(t,function(e){t.next(n.call(a,e,r++))}))})}function on(r){return sn(function(e){return t=r,Ze(e=e)?t.apply(void 0,jr([],Nr(e))):t(e);var t})}function cn(e,i,r,n,a,s,o,t){var c=[],u=0,d=0,l=function(){c.length||u||i.complete()},h=function(e){return u<n?p(e):c.push(e)},p=function(e){s&&i.next(e),u++;var t=!1;nn(r(e,d++)).subscribe(Xr(i,function(e){null!=a&&a(e),s?h(e):i.next(e)},function(){t=!0},void 0,function(){if(t)try{u--;for(;c.length&&u<n;)!function(){var e,t,r,n,a,s=c.shift();o?(e=i,r=function(){p(s)},void 0===n&&(n=0),void 0===a&&(a=!1),t=(t=o).schedule(function(){r(),a?e.add(this.schedule(null,n)):this.unsubscribe()},n),e.add(t)):p(s)}();l()}catch(e){i.error(e)}}))};return e.subscribe(Xr(i,h,function(){l()})),function(){null!=t&&t()}}function un(r,n,a,e){if(E(a)&&(e=a,a=void 0),e)return un(r,n,a).pipe(on(e));var e=Nr(E((e=r).addEventListener)&&E(e.removeEventListener)?Ne.map(function(t){return function(e){return r[t](n,e,a)}}):E((e=r).addListener)&&E(e.removeListener)?Pe.map(dn(r,n)):E((e=r).on)&&E(e.off)?je.map(dn(r,n)):[],2),t=e[0],s=e[1];if(!t&&Oe(r))return function e(a,s,r){return void 0===r&&(r=1/0),E(s)?e(function(r,n){return sn(function(e,t){return s(r,e,n,t)})(nn(a(r,n)))},r):("number"==typeof s&&(r=s),Qr(function(e,t){return cn(e,t,a,r)}))}(function(e){return un(e,n,a)})(nn(r));if(t)return new o(function(r){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.next(1<e.length?e:e[0])}return t(e),function(){return s(e)}});throw new TypeError("Invalid event target")}function dn(r,n){return function(t){return function(e){return r[t](n,e)}}}function ln(s,i){return void 0===i&&(i=Yr),s=null!=s?s:hn,Qr(function(e,r){var n,a=!0;e.subscribe(Xr(r,function(e){var t=i(e);!a&&s(n,t)||(a=!1,n=t,r.next(e))}))})}function hn(e,t){return e===t}function pn(e,t,r,n){{var a=Re.useEffect,s=[e,t,r,n];const i=(0,Re.useRef)(s),o=(0,Re.useRef)(),c=(0,Re.useRef)();Ie(()=>{i.current=s,o.current=Ae(s)}),a(()=>{const t=i.current[0],e=(o.current||(o.current=Ae(i.current)),t.subscribe({next:e=>{t===i.current[0]&&o.current.next?.(e)},error:e=>{t===i.current[0]&&(o.current.error?o.current:console).error(e)},complete:()=>{t===i.current[0]&&o.current.complete?.()}}));return c.current=e,()=>{e.unsubscribe()}},[s[0]]),c}}function fn(e){var[t,r]=(0,De.useState)(!1);pn(window.jukebox.stateChanged$,r);r=t?"Disable jukebox":"Enable jukebox";return De.default.createElement(Spicetify.ReactComponent.TooltipWrapper,{label:r,showDelay:100,renderInline:!1},De.default.createElement(Spicetify.ReactComponent.ButtonTertiary,{"aria-label":r,buttonSize:"sm",onClick:async e=>{e.stopPropagation(),await window.jukebox.setEnabled(!window.jukebox.isEnabled)},iconOnly:()=>De.default.createElement(se,{size:24}),className:Spicetify.classnames(e.className,{active:t})}))}function mn(){return Je}function R(e,t){var r=Je,t=He({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===We?void 0:We].filter(e=>!!e)});e.common.issues.push(t)}function vn(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e===t&&n:t.has(e))return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e);throw new TypeError("Cannot read private member from an object whose class did not declare it")}function yn(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?a.call(e,r):a?a.value=r:t.set(e,r)}function I(a){if(!a)return{};const{errorMap:e,invalid_type_error:s,required_error:i,description:t}=a;if(e&&(s||i))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:t}:{errorMap:(e,t)=>{var r,n=a["message"];return"invalid_enum_value"===e.code?{message:null!=n?n:t.defaultError}:void 0===t.data?{message:null!=(r=null!=n?n:i)?r:t.defaultError}:"invalid_type"!==e.code?{message:t.defaultError}:{message:null!=(r=null!=n?n:s)?r:t.defaultError}},description:t}}function gn(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t+="(\\.\\d+)?"),t}function bn(e){return new RegExp(`^${gn(e)}$`)}function _n(e){var t=yt+"T"+gn(e),r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t+=`(${r.join("|")})`,new RegExp(`^${t}$`)}function xn(e,t){return("v4"===t||!t)&&lt.test(e)||!("v6"!==t&&t||!pt.test(e))}function wn(e,t){if(ct.test(e))try{var[r]=e.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),a=JSON.parse(atob(n));return"object"==typeof a&&null!==a?!(!a.typ||!a.alg||t&&a.alg!==t):void 0}catch(e){}}function kn(e,t){return("v4"===t||!t)&&ht.test(e)||!("v6"!==t&&t||!ft.test(e))}function Sn(e,t){var r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,r=n<r?r:n;return parseInt(e.toFixed(r).replace(".",""))%parseInt(t.toFixed(r).replace(".",""))/Math.pow(10,r)}function Tn(e){if(e instanceof k){const r={};for(const n in e.shape){var t=e.shape[n];r[n]=C.create(Tn(t))}return new k({...e._def,shape:()=>r})}return e instanceof w?new w({...e._def,type:Tn(e.element)}):e instanceof C?C.create(Tn(e.unwrap())):e instanceof Ut?Ut.create(Tn(e.unwrap())):e instanceof T?T.create(e.items.map(e=>Tn(e))):e}function Bn(t,r){var e=h(t),n=h(r);if(t===r)return{valid:!0,data:t};if(e===v.object&&n===v.object){const u=l.objectKeys(r);var a=l.objectKeys(t).filter(e=>-1!==u.indexOf(e)),s={...t,...r};for(const d of a){var i=Bn(t[d],r[d]);if(!i.valid)return{valid:!1};s[d]=i.data}return{valid:!0,data:s}}if(e!==v.array||n!==v.array)return e===v.date&&n===v.date&&+t==+r?{valid:!0,data:t}:{valid:!1};if(t.length!==r.length)return{valid:!1};var o=[];for(let e=0;e<t.length;e++){var c=Bn(t[e],r[e]);if(!c.valid)return{valid:!1};o.push(c.data)}return{valid:!0,data:o}}function Cn(e,t){return new Lt({values:e,typeName:O.ZodEnum,...I(t)})}function On(n,a={},s){return n?Bt.create().superRefine((e,t)=>{var r;n(e)||(r=null==(r=null!=(r=(e="function"==typeof a?a(e):"string"==typeof a?{message:a}:a).fatal)?r:s)||r,t.addIssue({code:"custom",..."string"==typeof e?{message:e}:e,fatal:r}))}):Bt.create()}async function En(e){_r.parse(e);e=function(e){var t=e._base62Id;if(t)return t;if(e.id)return e.id;throw new Error("URI does not have an ID")}(Spicetify.URI.fromString(e.uri));return(await function(e=!1){let t=Br().RequestBuilder.build().withHost(Ke);return t=e?t.withoutMarket():t}().withPath("/audio-analysis/"+e).withEndpointIdentifier("/audio-analysis/{id}").send()).body}}();